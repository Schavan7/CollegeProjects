"use strict";function SearchSerializer(n,t){return{deserialize:n,serialize:t||String}}function DefaultSerializer(n,t){return{serialize:function(i){return t===i?undefined:n.serialize(i)},deserialize:function(i){return i===undefined?t:n.deserialize(i)}}}function MultiDefaultSerializer(n,t){return{serialize:function(i){for(var f,r=0,u=t;r<u.length;r++)if(f=u[r],f===i)return undefined;return n.serialize(i)},deserialize:function(i){return i===undefined?t[0]:n.deserialize(i)}}}function buttonsToContext(n,t){function f(n){var t='<a href="#" style="padding-left:8px"><span>';return n.shortcut&&(t+='<span class="pull-right">('+n.shortcut+")<\/span>"),t+('<span style="padding-right:8px">'+n.text+"<\/span><\/span><\/a>")}for(var r=[],o=function(t){var i,u;switch(t.type){case"link":i=t;t.contextual&&r.push({html:f(t),click:function(t){var r=i.getHref(t.contextItem);i.target?n.open(r,i.target):n.location.assign(r)},enabled:function(n){return!i.hidden&&(i.getDisabled==undefined||!i.getDisabled(n.contextItem))}});break;case"action":u=t;t.contextual&&r.push({html:f(t),click:function(n){u.click(n.contextItem)},enabled:function(n){return(u.getDisabled==undefined||!u.getDisabled(n.contextItem))&&!u.hidden}})}},e,i=0,u=t;i<u.length;i++)e=u[i],o(e);return r}function addHtmlEntities(n){return String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function removeHtmlEntities(n){return n?n.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'):""}function makeURL(n,t){var r=n,u=[],i;for(i in t)t[i]!==undefined&&u.push(i+"="+String(t[i]));return u.length&&(r+="?",r+=u.join("&")),r}function getExtension(n){var t;return(t=n.lastIndexOf("."))==-1?"":n.substr(t+1)}function sourceToArray(n){return typeof n=="string"?n.split("\n").map(function(n){return n+"\n"}):n}function sourceLength(n){var i,t;return i=typeof n.source=="string"?n.source:n.source.join(""),t=i.split("\n"),{line:t.length,ch:t[t.length-1].length}}function fillArray(n,t){for(var r=Array(n),i=0;i<n;i++)r[i]=t;return r}function diff_cleanupNewlines(n){for(var i,t=0;t<n.length;t++)n[t][0]==DIFF_DELETE&&t+1<n.length&&n[t+1][0]==DIFF_INSERT&&n[t][1].indexOf("\n")!=-1&&(i=n[t],n[t]=n[t+1],n[t+1]=i,t++)}function uiCodemirrorDirective(n,t){function i(n,i,o,s){var c=angular.extend({value:i.text()},t.codemirror||{},n.$eval(o.uiCodemirror),n.$eval(o.uiCodemirrorOpts)),h=r(i,c);if(u(h,o.uiCodemirror||o.uiCodemirrorOpts,n),f(h,s,n,c),e(h,o.uiRefresh,n),n.$on("CodeMirror",function(n,t){if(angular.isFunction(t))t(h);else throw new Error("the CodeMirror event requires a callback function");}),angular.isFunction(c.onLoad))c.onLoad(h)}function r(n,t){var i;return n[0].tagName==="TEXTAREA"?i=window.CodeMirror.fromTextArea(n[0],t):(n.html(""),i=new window.CodeMirror(function(t){n.append(t);t.style.height="auto"},t)),i}function u(n,t,i){function u(t,i){angular.isObject(t)&&r.forEach(function(r){if(t.hasOwnProperty(r)){if(i&&t[r]===i[r])return;n.setOption(r,t[r])}})}if(t){var r=Object.keys(window.CodeMirror.defaults);i.$watch(t,u,!0)}}function f(n,t,i){if(t){t.$formatters.push(function(n){if(angular.isUndefined(n)||n===null)return"";if(angular.isObject(n)||angular.isArray(n))throw new Error("ui-codemirror cannot use an object or an array as a model");return n});t.$render=function(){var i=t.$viewValue||"";n.setValue(i);setTimeout(function(){n.refresh()},1)};n.on("change",function(n){console.log("change");var r=n.getValue();r!==t.$viewValue&&i.$evalAsync(function(){t.$setViewValue(r)})})}}function e(t,i,r){i&&r.$watch(i,function(i,r){i!==r&&n(function(){t.refresh()})})}return{restrict:"EA",require:"?ngModel",compile:function(){if(angular.isUndefined(window.CodeMirror))throw new Error("ui-codemirror needs CodeMirror to work... (o rly?)");return i}}}var forceSigninIfViewingHomeUrl=["UserService","$route",function(n,t){return t.current.params.uid.toLowerCase()=="home"?n.curUserOrError():!1}],SiteController,StatusController,AdminConsentController,LogService,SettingsService,ScriptService,RenderOnVisibleService,RenderOnVisibleController,RedirectOnResolve,CloseOnFocusLostService,SearchProxyService,SearchSerializers,NotFoundController,PagedData,PagedDataController,DownloadService,DialogService,LibraryService,AddFileController,AddFileService,AddFileBlankController,AddFileUrlController,AddFileLocalController,CloneLibraryController,CreateServerController,DeleteLibraryController,DeleteNotebookController,EditLibraryController,NotebookStartupErrorController,LibraryHtmlController,LibraryController,NewLibraryController,LibraryNotFoundController,ShareLibraryController,ShutdownLibraryController,SlowStartupController,HelpController,HelpTopicController,HelpDetailsController,HelpSummaryController,HelpLinkController,IndexController,ErrorController,RestartController,ImportController,FAQController,UserService,EditFileController,UserSettingsController,UserLibraryController,UserLibrariesController,ClonesListController,UserIdController,RestartLibraryController,LibraryDiffController,NotebookCellController,LazyDiffController,FileDiffController,ImageDiffController,IpynbDiffController,TextDiffController,ProfileController;angular.module("notebooks",["ngRoute","notebooks.libraries","notebooks.whatsnew","notebooks.faq","notebooks.import","notebooks.index","notebooks.user","notebooks.diff","notebooks.help",]).run(["$rootScope","LogService","$route","$window","$location",function(n,t,i,r,u){function f(n){if(n===undefined)return undefined;if(typeof n=="function")return n.name;if(typeof n=="string"){var t=n.indexOf(" ");return t==-1?n:n.substr(0,t)}return String(n)}n.$on("$routeChangeSuccess",function(r,e,o){var h=undefined,s;o!==undefined&&(h=o.controller);s=i.current.$$route.title;n.page_title=s?typeof s=="function"?s(i)+" - Microsoft Azure Notebooks":s+" - Microsoft Azure Notebooks":"Microsoft Azure Notebooks";t.metric("Route.Success",1,{controller:f(e.controller),previous:f(h),url:u.url()})});n.$on("$routeChangeError",function(n,i,u,f){f instanceof RedirectOnResolve?r.location.href=f.url:t.event("RouteChangeError","Failed to change route "+i.templateUrl+" because "+String(f),"error")})}]).config(["$locationProvider","$routeProvider",function(n,t){n.html5Mode(!0);t.when("/status",{title:"Service Status",templateUrl:"/content/app/status.html",controller:StatusController,controllerAs:"$ctrl",resolve:{status:["$http",function(n){return n.get("/api/status").then(function(n){return n.data})}]}});t.when("/account/adminConsent",{templateUrl:"/content/app/adminConsent.html",controller:AdminConsentController,controllerAs:"$ctrl",resolve:{}});t.when("/:uid",{title:function(n){return n.current.params.uid},templateUrl:"/content/app/user/profile.html",controller:ProfileController,controllerAs:"$ctrl",reloadOnSearch:!1,resolve:{user:["UserService","$route",function(n,t){return n.get(t.current.params.uid).then(function(n){return n},function(){return{id:undefined}})}],activeTab:["$location",function(n){var t=n.search().active;return t=="libraries"?1:0}],signedIn:["UserService",function(n){return n.checkSignedIn()}],isHome:forceSigninIfViewingHomeUrl}});t.when("/:uid/libraries",{title:function(n){return n.current.params.uid+" libraries"},templateUrl:"/content/app/user/userLibraries.html",controller:UserLibrariesController,controllerAs:"$ctrl",reloadOnSearch:!1,resolve:{user:["UserService","$route",function(n,t){return n.get(t.current.params.uid).then(function(n){return n},function(){return{id:undefined}})}],gitUrl:function(){return undefined},isHome:forceSigninIfViewingHomeUrl,libraries:["UserService","$route",function(n,t){var i=n.getLibrariesCached(t.current.params.uid);return i?i:n.getLibraries(t.current.params.uid).then(function(n){return n},function(){return undefined})}]}});t.when("/:uid/libraries/:library",{title:function(n){return n.current.params.library+" ("+n.current.params.uid+")"},templateUrl:"/content/app/user/userLibrary.html",controller:UserLibraryController,controllerAs:"$ctrl",resolve:{user:["UserService","$route",function(n,t){return n.get(t.current.params.uid).then(function(n){return n},function(){return{id:undefined}})}],library:["UserService","$route",function(n,t){return n.libraryDirectory(t.current.params.uid,t.current.params.library,"").then(function(n){return n},function(){return undefined})}],path:[function(){return""}],isHome:forceSigninIfViewingHomeUrl},reloadOnSearch:!1});t.when("/:uid/libraries/:library/tree/:path*",{title:function(n){return n.current.params.library+" ("+n.current.params.uid+")"},templateUrl:"/content/app/user/userLibrary.html",controller:UserLibraryController,controllerAs:"$ctrl",resolve:{user:["UserService","$route",function(n,t){return n.get(t.current.params.uid).then(function(n){return n},function(){return{id:undefined}})}],library:["UserService","$route",function(n,t){return n.libraryDirectory(t.current.params.uid,t.current.params.library,t.current.params.path).then(function(n){return n},function(){return undefined})}],path:["$route",function(n){return n.current.params.path+"/"}],isHome:forceSigninIfViewingHomeUrl},reloadOnSearch:!1});t.when("/:uid/libraries/:library/diff",{title:function(n){return n.current.params.library+" ("+n.current.params.uid+") - Diff"},templateUrl:"/content/app/diff/libraryDiff.html",controller:LibraryDiffController,controllerAs:"$ctrl",resolve:{user:["UserService","$route",function(n,t){return n.get(t.current.params.uid).then(function(n){return n},function(){return{id:undefined}})}],library:["UserService","$route",function(n,t){return n.library(t.current.params.uid,t.current.params.library).then(function(n){return n},function(){return undefined})}],diff:["UserService","$route","$location",function(n,t,i){var r=i.search().diffUser,u;return r||(r=t.current.params.uid),u=i.search().diffLib,n.library(r,u).then(function(n){return n},function(){return undefined})}],codemirror:["ScriptService","$q",function(n,t){return n.loadScript("/Content/jupyter/4.3.1/components/codemirror/lib/codemirror.js").then(function(){return t.all([n.loadScript("/Scripts/diff_match_patch.js"),n.loadScript("/Content/jupyter/4.3.1/components/codemirror/mode/python/python.js"),n.loadScript("/Content/jupyter/4.3.1/components/codemirror/mode/markdown/markdown.js"),n.loadScript("/Content/jupyter/4.3.1/components/codemirror/mode/r/r.js")])})}],isHome:forceSigninIfViewingHomeUrl},reloadOnSearch:!1});t.when("/:uid/libraries/:library/clones",{title:function(n){return n.current.params.library+" ("+n.current.params.uid+") - Clones"},templateUrl:"/content/app/user/clones.html",controller:ClonesListController,controllerAs:"$ctrl",resolve:{user:["UserService","$route",function(n,t){return n.get(t.current.params.uid).then(function(n){return n},function(){return{id:undefined}})}],library:["UserService","$route",function(n,t){return n.library(t.current.params.uid,t.current.params.library).then(function(n){return n},function(){return undefined})}],isHome:forceSigninIfViewingHomeUrl},reloadOnSearch:!1});t.when("/:uid/libraries/:library/html/:notebook*",{title:function(n){return n.current.params.library+"/"+n.current.params.notebook+" ("+n.current.params.uid+")"},templateUrl:"/content/app/user/html.html",controller:LibraryHtmlController,controllerAs:"$ctrl",resolve:{library:["UserService","$route",function(n,t){return n.library(t.current.params.uid,t.current.params.library).then(function(n){return n},function(){return undefined})}],file:["$route",function(n){return n.current.params.notebook}],isHome:forceSigninIfViewingHomeUrl},reloadOnSearch:!1});t.when("/:uid/libraries/:library/restart",{templateUrl:"/content/app/user/restartLibrary.html",controller:RestartLibraryController,controllerAs:"$ctrl",resolve:{library:["UserService","$route",function(n,t){return n.library(t.current.params.uid,t.current.params.library).then(function(n){return n},function(){return undefined})}],status:["UserService","$route",function(n,t){return n.libraryStatus(t.current.params.uid,t.current.params.library).then(function(n){return n},function(){return undefined})}],isHome:forceSigninIfViewingHomeUrl}});t.when("/:uid/libraries/:library/edit/:file*",{templateUrl:"/content/app/user/editFile.html",controller:EditFileController,controllerAs:"$ctrl",resolve:{library:["UserService","$route",function(n,t){return n.library(t.current.params.uid,t.current.params.library).then(function(n){return n},function(){return undefined})}],file:["$route",function(n){return n.current.params.file}],contents:["LibraryService","$route",function(n,t){return n.getFile({owner:t.current.params.uid,id:t.current.params.library},t.current.params.file)}],codemirror:["ScriptService","$q",function(n,t){return n.loadScript("/Content/jupyter/4.3.1/components/codemirror/lib/codemirror.js").then(function(){return t.all([n.loadScript("/Content/jupyter/4.3.1/components/codemirror/mode/python/python.js"),n.loadScript("/Content/jupyter/4.3.1/components/codemirror/mode/markdown/markdown.js"),n.loadScript("/Content/jupyter/4.3.1/components/codemirror/mode/r/r.js")])})}],isHome:forceSigninIfViewingHomeUrl}});t.when("/run/:uid/:library",{templateUrl:"/content/app/libraries/create_server.html",controller:CreateServerController,controllerAs:"create",resolve:{library:["$route","UserService",function(n,t){return t.library(n.current.params.uid,n.current.params.library).then(function(n){return n},function(){return undefined})}],creation:["LibraryService","$route",function(n,t){return n.createServer({owner:t.current.params.uid,id:t.current.params.library})}]}})}]);SiteController=function(){function n(n,t,i,r){this.$location=n;this.UserService=t;this.$route=i;this.DialogService=r;t.checkSignedIn()}return n.prototype.signin=function(){this.UserService.signin()},n.prototype.signout=function(){this.UserService.signout()},n.prototype.getSignedIn=function(){return this.UserService.user.signedIn},n.prototype.getCurUserDisplayName=function(){return this.UserService.user.id?this.UserService.user.id:this.UserService.user.email},n.prototype.getUserHomeLink=function(){return this.UserService.user.id?"/"+this.UserService.user.id:"/home"},n.prototype.updateUserId=function(){this.DialogService.userIdInit(this.UserService.user,"")},Object.defineProperty(n.prototype,"contextHelpLink",{get:function(){var t,n;return this.$route.current&&this.$route.current.locals&&(t=this.$route.current.locals.$scope,this.$route.current.controllerAs&&(n=t[this.$route.current.controllerAs],n&&n.contextHelpLink))?n.contextHelpLink:"/help"},enumerable:!0,configurable:!0}),n}();SiteController.$inject=["$location","UserService","$route","DialogService"];angular.module("notebooks").controller("SiteController",SiteController),function(){angular.module("angulike",[]).directive("fbLike",["$window","$rootScope",function(n,t){return{restrict:"A",scope:{fbLike:"=?"},link:function(i,r,u){function f(){if(!u.fbLike||i.fbLike||e)r.html('<div class="fb-like"'+(!i.fbLike?"":' data-href="'+i.fbLike+'"')+' data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"><\/div>'),n.FB.XFBML.parse(r.parent()[0]);else{e=!0;var t=i.$watch("fbLike",function(n){n&&(f(),t())});return}}n.FB?f():$.getScript("//connect.facebook.net/en_US/sdk.js",function(){n.FB.init({appId:t.facebookAppId,xfbml:!0,version:"v2.0"});f()});var e=!1}}}]).directive("googlePlus",["$window",function(n){return{restrict:"A",scope:{googlePlus:"=?"},link:function(t,i,r){function u(){if(!r.googlePlus||t.googlePlus||f)i.html('<div class="g-plusone"'+(!t.googlePlus?"":' data-href="'+t.googlePlus+'"')+' data-size="medium"><\/div>'),n.gapi.plusone.go(i.parent()[0]);else{f=!0;var e=t.$watch("googlePlus",function(n){n&&(u(),e())});return}}n.gapi?u():$.getScript("//apis.google.com/js/platform.js",function(){u()});var f=!1}}}]).directive("tweet",["$window","$location",function(n,t){return{restrict:"A",scope:{tweet:"=",tweetUrl:"="},link:function(i,r){function u(){if(i.tweet||f)r.html('<a href="https://twitter.com/intent/tweet?text='+encodeURIComponent(i.tweet)+'" class="twitter-share-button" data-url="'+(i.tweetUrl||t.absUrl())+'">Tweet<\/a>'),n.twttr.widgets.load(r.parent()[0]);else{f=!0;var e=i.$watch("tweet",function(n){n&&(u(),e())});return}}n.twttr?u():$.getScript("//platform.twitter.com/widgets.js",function(){u()});var f=!1}}}]).directive("pinIt",["$window","$location",function(n,t){return{restrict:"A",scope:{pinIt:"=",pinItImage:"=",pinItUrl:"="},link:function(i,r){function u(){if(i.pinIt||f)r.html('<a href="//www.pinterest.com/pin/create/button/?url='+(i.pinItUrl||t.absUrl())+"&media="+i.pinItImage+"&description="+i.pinIt+'" data-pin-do="buttonPin" data-pin-config="beside"><\/a>'),n.parsePins(r.parent()[0]);else{f=!0;var e=i.$watch("pinIt",function(n){n&&(u(),e())});return}}n.parsePins?u():function(t){var r=t.getElementsByTagName("SCRIPT")[0],i=t.createElement("SCRIPT");i.type="text/javascript";i.async=!0;i.src="//assets.pinterest.com/js/pinit.js";i["data-pin-build"]="parsePins";i.onload=function(){n.parsePins?u():setTimeout(i.onload,100)};r.parentNode.insertBefore(i,r)}(n.document);var f=!1}}}])}();StatusController=function(){function n(n){this.status=n}return n}();StatusController.$inject=["status"];AdminConsentController=function(){function n(n,t){var i=this;this.UserService=n;this.$location=t;this.redirectUrl="https://"+location.host;this.consented=t.search().admin_consent=="True";this.consented?this.tenant=t.search().tenant:(n.checkSignedIn().then(function(){i.tenant=n.user.tenant}),n.getServiceConfig().then(function(n){i.config=n}))}return n}();AdminConsentController.$inject=["UserService","$location"];LogService=function(){function n(n){this.$http=n}return n.prototype.event=function(n,t,i){return this.$http.put("/api/log/event/"+encodeURI(n),{message:t,level:i},{responseType:"arraybuffer"})},n.prototype.metric=function(n,t,i){return this.$http.put("/api/log/metric/"+encodeURI(n)+"/"+t,i||{},{responseType:"arraybuffer"})},n}();LogService.$inject=["$http"];SettingsService=function(){function n(n){this.$http=n}return n.prototype.samples=function(){return this.$http.get("/api/settings/samples").then(function(n){return n.data.samples})},n.prototype.featuredContent=function(){return this.$http.get("/api/settings/featuredContent").then(function(n){return n.data})},n}();SettingsService.$inject=["$http"];ScriptService=function(){function n(n,t){this.$document=n;this.$q=t;this.documents={}}return n.prototype.loadScript=function(n){var t=this.documents[n],i;return t||(this.documents[n]=t=this.$q.defer(),i=this.$document[0].createElement("script"),i.src=n,this.$document[0].head.appendChild(i),i.onload=function(n){t.resolve(n)},i.onerror=function(n){t.reject(n)}),t.promise},n}();ScriptService.$inject=["$document","$q"];RenderOnVisibleService=function(){function n(n,t,i){var e=this,r,u,f;for(this.$rootScope=i,this.elements=[],this.freeList=[],r=0,u=["load","resize","scroll","DOMContentLoaded"];r<u.length;r++)f=u[r],window.document.addEventListener(f,function(){e.checkVisibility()},!1)}return n.prototype.checkVisibility=function(){var n=this;this.$rootScope.$apply(function(){for(var i,t=0;t<n.elements.length;t++)i=n.elements[t],i&&n.isElementInViewport(i.element)&&(n.freeElement(t),i.component.makeVisible())})},n.prototype.register=function(n,t){this.isElementInViewport(n)?t.makeVisible():this.freeList.length!=0?this.elements[this.freeList.pop()]={element:n,component:t}:this.elements.push({element:n,component:t})},n.prototype.unregister=function(n){for(var t=0;t<this.elements.length;t++)if(this.elements[t]&&this.elements[t].element==n){this.freeElement(t);break}},n.prototype.freeElement=function(n){delete this.elements[n];this.freeList.push(n);this.freeList.length==this.elements.length&&(this.freeList=[],this.elements=[])},n.prototype.isElementInViewport=function(n){var t=n.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},n}();RenderOnVisibleService.$inject=["$window","$document","$rootScope"];RenderOnVisibleController=function(){function n(n,t,i){var r=this;this.$element=n;this.$scope=t;this.RenderOnVisibleService=i;this.everVisible=!1;i.register(n[0],this);t.$on("$destroy",function(){r.everVisible||i.unregister(n[0])})}return n.prototype.makeVisible=function(){this.everVisible=!0},n}();RenderOnVisibleController.$inject=["$element","$scope","RenderOnVisibleService"];angular.module("notebooks.utils",["ui.bootstrap"]).service("LogService",LogService).service("SettingsService",SettingsService).service("ScriptService",ScriptService).service("RenderOnVisibleService",RenderOnVisibleService).config(["$routeProvider",function(n){n.otherwise({templateUrl:"/content/app/utils/notFound.html",controller:"NotFoundController as notFound",resolve:{display:function(){return!0}}})}]).component("renderOnVisible",{transclude:!0,template:'<div ng-if="$ctrl.everVisible"><ng-transclude><\/ng-transclude><\/div>',controller:RenderOnVisibleController}).directive("fileChange",function(){return{restrict:"A",link:function(n,t,i){var r=n.$eval(i.fileChange);t.bind("change",function(t){n.$apply(function(){return r(t)})})}}}).directive("gettingStarted",["$cookies",function(n){return{templateUrl:"/content/app/libraries/getting_started.html",restrict:"E",link:function(t){t.$cookies=n}}}]).directive("shareButtons",function(){return{templateUrl:"/content/app/libraries/share_buttons.html",restrict:"E",scope:{shareUrl:"=",shareText:"="}}}).directive("copyClipboardLink",function(){return{restrict:"A",link:function(n,t){new Clipboard(t[0]);t.on("click",function(){$(this).text("Copied!");setTimeout(function(){t.text("Copy to clipboard")},2e3)})}}}).directive("files",function(){return{restrict:"A",scope:{files:"="},link:function(n,t){t.bind("change",function(t){n.$apply(function(){n.files=t.target.files})})}}}).directive("ckeditor",["ScriptService",function(n){return{restrict:"A",require:"?ngModel",scope:{ckeditor:"@",ckeditorMode:"@"},link:function(t,i,r,u){console.log("model",u);i.attr("id",t.ckeditor);console.log("mode is",t.ckeditorMode);n.loadScript("/Scripts/ckeditor/ckeditor.js").then(function(){var i={},n;i.removePlugins=t.ckeditorMode!="markdown"?"markdown":"sourcearea";n=CKEDITOR.replace(t.ckeditor,i);u.$render=function(){console.log("setting value",u.$viewValue);n.setData(u.$viewValue)};n.on("mode",function(n,t,i){console.log("new mode",n,t,i)});n.on("change",function(){console.log(n);console.log(n.getData());u.$setViewValue(n.getData())})})}}}]).filter("convertEntities",function(){return removeHtmlEntities}).filter("escape",function(){return encodeURIComponent}).filter("notebookLanguage",function(){return function(n){switch(n){case"python2":return"Python 2.x";case"python3":return"Python 3.x";case"r":return"R";case"ifsharp":return"F#";case null:case undefined:case"":return"Unknown";default:return n}}}).filter("trusted",["$sce",function(n){return function(t){return n.trustAsHtml(t)}}]).directive("focusOn",["$timeout",function(n){return{restrict:"A",link:function(t,i,r){r.focusOn&&t.$on(r.focusOn,function(){n(function(){i[0].focus()},10)})}}}]).directive("focusOnLoad",["$timeout",function(n){return{restrict:"A",link:function(t,i){n(function(){i[0].focus()},10)}}}]).directive("stopClickPropogation",["$timeout",function(){return{restrict:"A",link:function(n,t){t.bind("click",function(n){n.stopPropagation()})}}}]).directive("onEscape",function(){return function(n,t,i){t.bind("keydown keypress",function(t){t.which===27&&(n.$apply(function(){n.$eval(i.onEscape)}),t.preventDefault())})}});RedirectOnResolve=function(){function n(n){this.url=n}return n}();CloseOnFocusLostService=function(){function n(){}return n}();angular.module("notebooks.utils").service("CloseOnFocusLostService",CloseOnFocusLostService);SearchProxyService=function(){function n(n){this.$location=n}return n.prototype.makeSearchProxyDescriptor=function(n,t){var i=this,u=this.$location.path(),r=undefined;return{get:function(){return u!=i.$location.path()?r:r=t.deserialize(i.$location.search()[n])},set:function(f){u==i.$location.path()&&(i.$location.search(n,t.serialize(f)),r=f)},enumerable:!0}},n.prototype.makeSearchProxy=function(n){var i={},t;for(t in n)Object.defineProperty(i,t,this.makeSearchProxyDescriptor(t,n[t]));return i},n}();SearchProxyService.$inject=["$location"];SearchSerializers=function(){function n(){}return n.Pagination=function(t){return{page:n.DefaultNumber(1),sort:n.DefaultString(t),reversed:n.FalseBoolean}},n}();SearchSerializers.UndefinedString=MultiDefaultSerializer(SearchSerializer(String),[undefined,""]);SearchSerializers.UndefinedNumber=DefaultSerializer(SearchSerializer(Number),undefined);SearchSerializers.DefaultNumber=function(n){return DefaultSerializer(SearchSerializer(Number),n)};SearchSerializers.DefaultString=function(n){return DefaultSerializer(SearchSerializer(String),n)};SearchSerializers.boolFalse=function(n){switch(n){case"true":case"1":return!0;case"false":case"0":default:return!1}};SearchSerializers.FalseBoolean=MultiDefaultSerializer(SearchSerializer(SearchSerializers.boolFalse),[!1,undefined]);angular.module("notebooks.utils").service("SearchProxyService",SearchProxyService);NotFoundController=function(){function n(n,t){this.display===undefined&&(this.display=!0);this.display&&n.event("404","PageNotFound: "+t.url(),"warning")}return n}();NotFoundController.$inject=["LogService","$location"];angular.module("notebooks.utils").controller("NotFoundController",NotFoundController).directive("maybeNotFound",function(){return{restrict:"E",templateUrl:"/content/app/utils/notfound.html",scope:{display:"="},transclude:!0,controller:"NotFoundController as notFound",bindToController:!0}});PagedData=function(){function n(n,t,i,r){var u=this,f;this.pagination=t;this.filter=i;this.itemType=r;f=this;this.all=[];this.displayed=[];this.filteredCount=0;this.itemsPerPage=10;n.$watch(function(){return u.all},function(){return u.refreshList("all")},!0);i.values!==undefined&&n.$watch(function(){return u.filter.values},function(){return u.refreshList("filters")},!0);n.$watch(function(){return u.pagination},function(){return u.refreshList("pagination")},!0)}return n.prototype.sort=function(n,t){return(typeof n=="string"&&(n=n.toLowerCase()),typeof t=="string"&&(t=t.toLowerCase()),n==t)?0:n>t?1:-1},n.prototype.range=function(){if(this.pagination.page==1&&this.displayed.length<this.itemsPerPage)return this.displayed.length.toString();var n=(this.pagination.page-1)*this.itemsPerPage+1,t=Math.min(this.pagination.page*this.itemsPerPage,this.filteredCount);return n.toString()+" to "+t},n.prototype.getItemType=function(){return this.all.length==1?this.itemType.singular:this.itemType.plural},n.prototype.status=function(){if(this.displayed.length==0&&this.filteredCount!=this.all.length)return"Your search returned no results";var n="Showing "+this.range();return this.filteredCount!=this.all.length?(this.filteredCount!=this.displayed.length&&(n+=" of "+this.filteredCount),n+=" search result",this.filteredCount!=1&&(n+="s")):this.all.length!=this.displayed.length?(n+=" of "+this.all.length,n+=" "+this.getItemType()):n+=" "+this.getItemType(),this.filteredCount!=this.all.length&&(n+=" ("+(this.all.length-this.filteredCount)+" hidden)"),n},n.prototype.setSortProperty=function(n){this.pagination.sort==n?this.pagination.reversed=!this.pagination.reversed:(this.pagination.sort=n,this.pagination.reversed=!1)},n.prototype.isEmptySearch=function(){return this.displayed.length==0?this.all.length!=0:!1},n.prototype.isEmpty=function(){return this.all.length==0},n.prototype.setItems=function(n){this.all=n;this.refreshList("set items")},n.prototype.refreshList=function(){var t=this,i=this.all,u,e,r,f,n;if(i=this.all.filter(function(n){return t.filter.match(n)}),this.filteredCount=i.length,u=Math.floor(this.all.length/this.itemsPerPage)+1,this.pagination.page>u&&(this.pagination.page=u),i=i.sort(function(n,i){var u=n[t.pagination.sort],f=i[t.pagination.sort],r=t.sort(u,f);return t.pagination.reversed&&(r*=-1),r}),this.displayed=i.slice((this.pagination.page-1)*this.itemsPerPage,this.pagination.page*this.itemsPerPage),this.selected!==undefined&&(e=this.displayed.indexOf(this.selected),e==-1&&(r=this.all.indexOf(this.selected),r!==undefined))){for(f=!1,n=r+1;n<this.all.length;n++)if(this.adjustSelection(n)){f=!0;break}if(!f)for(n=r-1;n>=0;n--)if(this.adjustSelection(n))break}},n.prototype.adjustSelection=function(n){var t;return(t=this.displayed.indexOf(this.all[n]))!==-1?(this.selected=this.displayed[t],!0):!1},n.prototype.getRowClass=function(n){return n==this.selected?"user-library-table-selected":""},n.prototype.selectRow=function(n){this.selected=this.selected==n?undefined:n},n.prototype.getContextButtonsDisabled=function(){return this.displayed.indexOf(this.selected)==-1},n}();var Filters=function(){function n(){}return n.MatchString=function(n,t){return t===undefined?!0:n.toLowerCase().indexOf(t.toLowerCase())!=-1},n.MatchEquals=function(n,t){return t===undefined||n==t},n}(),TableSearchItemFilters=function(){function n(n,t){var r,i;this.controls={};r={};for(i in t)r[i]=t[i].serializer,this.controls[i]=t[i].control;this.values=n.makeSearchProxy(r);this.filter=new ItemFilter(this.values,t)}return n}(),ItemFilter=function(){function n(n,t){this.values=n;this.filters=t}return n.prototype.match=function(n){var t,i,r;for(t in this.values)for(i in this.filters[t].matchers)if(r=n[i],!this.filters[t].matchers[i](r,this.values[t]))return!1;return!0},n}(),TableHeaderController=function(){function n(){}return n.prototype.setSortProperty=function(){this.tableData.data.items.setSortProperty(this.sortColumn)},Object.defineProperty(n.prototype,"chevronUp",{get:function(){return this.tableData.data.items.pagination.sort==this.sortColumn&&this.tableData.data.items.pagination.reversed},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"chevronDown",{get:function(){return this.tableData.data.items.pagination.sort==this.sortColumn&&!this.tableData.data.items.pagination.reversed},enumerable:!0,configurable:!0}),n}();TableHeaderController.$inject=[];PagedDataController=function(){function n(n,t){this.$scope=n;this.$location=t}return n.prototype.getButtonTitle=function(n){return n.shortcut?n.title+" (Shortcut: "+n.shortcut+")":n.title},n.prototype.$onInit=function(){var i=this,n=this.data.items,f,r,t,u,e;for(this.keyBindings={"Alt-Down":function(){if(n.selected===undefined)n.selected=n.displayed[0];else{var t=n.displayed.indexOf(n.selected);t==n.displayed.length-1?n.all.length>n.pagination.page*n.itemsPerPage&&(n.pagination.page++,n.refreshList("key down"),n.selected=n.displayed[0],i.$scope.$broadcast("focusOnPagedDataPageChange")):n.selected=n.displayed[t+1]}},"Alt-Up":function(){if(n.selected===undefined)n.selected=n.displayed[n.displayed.length-1];else{var t=n.displayed.indexOf(n.selected);t==0?n.pagination.page>1&&(n.pagination.page--,n.refreshList("key up"),n.selected=n.displayed[n.displayed.length-1],i.$scope.$broadcast("focusOnPagedDataPageChange")):n.selected=n.displayed[t-1]}}},f=function(t){var u,f;t.type=="link"?(u=t,t.shortcut&&(r.keyBindings[t.shortcut]=function(){u.hidden||n.selected!==undefined&&u.getDisabled!==undefined&&u.getDisabled(n.selected)||u.contextual&&n.selected===undefined||i.$location.url(u.getHref(n.selected))})):t.type=="action"&&(f=t,r.keyBindings[t.shortcut]=function(){f.hidden||n.selected!==undefined&&f.getDisabled!==undefined&&f.getDisabled(n.selected)||f.contextual&&n.selected===undefined||f.click(n.selected)})},r=this,t=0,u=this.data.buttons;t<u.length;t++)e=u[t],f(e)},n}();PagedDataController.$inject=["$scope","$location"];angular.module("notebooks.utils").directive("pagedData",["$timeout",function(){return{controller:PagedDataController,controllerAs:"$ctrl",link:function(n,t){$(t[0].childNodes[0]).focus()},restrict:"A",bindToController:!0,scope:{data:"<pagedData"},transclude:!0,templateUrl:"/content/app/utils/pagedData.html"}}]).directive("pagedRows",["$compile",function(n){return{restrict:"A",require:"^^pagedData",terminal:!0,replace:!1,priority:1e3,link:function(t,i,r,u){i.removeAttr("paged-rows");t.data=u.data;i.attr("ng-repeat",r.pagedRows+" in data.items.displayed");i.attr("context-menu","data.contextMenu");i.attr("ng-if","data.items.displayed");i.attr("ng-class","data.items.getRowClass("+r.pagedRows+")");i.attr("ng-click","data.items.selectRow("+r.pagedRows+")");i.attr("ng-init","contextItem = "+r.pagedRows);n(i)(t)}}}]).directive("sortColumn",function(){return{restrict:"A",controller:TableHeaderController,controllerAs:"$ctrl",require:["sortColumn","^^pagedData"],scope:{sortColumn:"@"},transclude:!0,templateUrl:"/content/app/utils/sortColumn.html",bindToController:!0,link:function(n,t,i,r){r[0].tableData=r[1]}}}).directive("kbShortcuts",function(){return{restrict:"A",scope:{kbShortcuts:"<"},link:function(n,t){function r(n,t){return t=="ArrowDown"?t="Down":t=="ArrowUp"&&(t="Up"),n.key==t.toLowerCase()}var i=[];n.$watch(function(){return n.kbShortcuts},function(){var r,u;i=[];r=n.kbShortcuts;for(u in r){for(var f=!1,e=!1,o=!1,t=u.toLowerCase();;)if(t.substr(0,6)=="shift-")f=!0,t=t.substr(6);else if(t.substr(0,4)=="alt-")e=!0,t=t.substr(4);else if(t.substr(0,4)=="ctrl-")o=!0,t=t.substr(5);else break;i.push({ctrl:o,alt:e,shift:f,key:t,action:r[u]})}},!0);$(t).keyup(function(t){var e,u,f,o;if(t.target.nodeName!="INPUT"&&(t.target.nodeName!="BUTTON"||$(event.target).hasClass("pagedDataButton")))for(e=function(i){r(i,t.key)&&i.ctrl==t.ctrlKey&&i.alt==t.altKey&&i.shift==t.shiftKey&&n.$apply(function(){return i.action()})},u=0,f=i;u<f.length;u++)o=f[u],e(o)})}}});DownloadService=function(){function n(n,t,i){this.$http=n;this.$window=t;this.$uibModal=i}return n.prototype.downloadUrl=function(n,t,i,r){var u=this;r&&this.$uibModal.open({animation:!0,templateUrl:"/content/app/utils/preparingDownload.html",controller:"PreparingDownloadController",controllerAs:"preparing"});this.$http.get(n,{headers:{Accept:i||"application/zip"},responseType:"arraybuffer"}).then(function(n){u.downloadData(n.data,t,i)})},n.prototype.downloadData=function(n,t,i){var u=new Blob([n],{type:i}),f,r;this.$window.navigator.msSaveOrOpenBlob?this.$window.navigator.msSaveBlob(u,t):(f=URL.createObjectURL(u),r=document.createElement("a"),r.href=f,r.target="_blank",r.download=t,document.body.appendChild(r),r.click())},n}();DownloadService.$inject=["$http","$window","$uibModal"];angular.module("notebooks.utils").service("DownloadService",DownloadService);angular.module("notebooks.utils").controller("PreparingDownloadController",["$uibModalInstance",function(n){var t=this;t.close=function(){n.close()}}]);DialogService=function(){function n(n,t,i){this.LogService=n;this.$uibModal=t;this.$location=i}return n.prototype.openSimple=function(n,t,i,r,u){return this.$uibModal.open({animation:!0,templateUrl:n,controller:t,controllerAs:i,resolve:r,size:u})},n.prototype.openShare=function(n){return this.openSimple("/content/app/libraries/shareLibrary.html",ShareLibraryController,"$ctrl",{library:n},"md")},n.prototype.shutdown=function(n){return this.openSimple("/content/app/libraries/shutdown.html",ShutdownLibraryController,"$ctrl",{library:n},"md")},n.prototype.userIdInit=function(n,t){return this.openSimple("/content/app/user/userid.html",UserIdController,"$ctrl",{reason:function(){return t},user:n},"md")},n}();DialogService.$inject=["LogService","$uibModal","$location"];angular.module("notebooks.utils").service("DialogService",DialogService);angular.module("notebooks.libraries",["ngMessages","ngRoute","ngSanitize","ui.bootstrap","ngCookies","notebooks.user","angulike","ngTagsInput","notebooks.utils","notebooks.help","angular-sortable-view"]).config(["$routeProvider",function(n){n.when("/library",{templateUrl:"/content/app/libraries/dashboard.html",controller:["library",function(){}],resolve:{library:["UserService","$q",function(n,t){var i=t.defer();return n.curUserOrError().then(function(){return i.reject(new RedirectOnResolve("/"+n.user.id+"/libraries"))},function(){return i.reject(new RedirectOnResolve("/account/signin?redirect=/library"))}),i.promise}]}});n.when("/library/:id/create_server",{templateUrl:"/content/app/libraries/create_server.html",controller:"CreateServerController as create",resolve:{libraryId:["$route",function(n){return n.current.params.id}],library:function(){return undefined},creation:["$route","LibraryService",function(n,t){return t.owner(n.current.params.id).then(function(n){return t.createServer({owner:n.owner,id:n.ownerLibId})})}]}});n.when("/library/:id/clone",{templateUrl:"/content/app/libraries/clone.html",controller:"CloneController as clone",resolve:{library:["LibraryService","$q","$route",function(n,t,i){var r=t.defer();return n.owner(i.current.params.id).then(function(n){return r.reject(new RedirectOnResolve("/"+n.owner+"/libraries/"+n.ownerLibId))},function(){return{error:"Does not exist"}}),r.promise}]}});n.when("/library/:id/dashboard",{templateUrl:"/content/app/libraries/library.html",controller:"LibraryController as current",resolve:{library:["LibraryService","$q","$route",function(n,t,i){var r=t.defer();return n.owner(i.current.params.id).then(function(n){return r.reject(new RedirectOnResolve("/"+n.owner+"/libraries/"+n.ownerLibId))},function(){return{error:"Does not exist"}}),r.promise}]}});n.when("/library/:id",{templateUrl:"/content/app/libraries/view.html",controller:"LibraryController as current",resolve:{library:["LibraryService","$q","$route",function(n,t,i){var r=t.defer();return n.owner(i.current.params.id).then(function(n){return r.reject(new RedirectOnResolve("/"+n.owner+"/libraries/"+n.ownerLibId))},function(){return{error:"Does not exist"}}),r.promise}]},reloadOnSearch:!1});n.when("/library/:id/html/:file*",{templateUrl:"/content/app/libraries/html.html",controller:"LibraryHtmlController as html",resolve:{library:["LibraryService","$q","$route",function(n,t,i){var r=t.defer();return n.owner(i.current.params.id).then(function(n){return r.reject(new RedirectOnResolve("/"+n.owner+"/libraries/"+n.ownerLibId+"/html/"+i.current.params.file))},function(){return{error:"Does not exist"}}),r.promise}],file:function(){return null}}})}]);LibraryService=function(){function n(n,t,i,r,u,f,e){this.$http=n;this.$window=t;this.UserService=i;this.DownloadService=r;this.$uibModal=u;this.$location=f;this.$interval=e}return n.prototype.libraries=function(n){var t="/api/libraries";return n&&(t+="?checkRunning=true"),this.$http.get(t).then(function(n){return n.data})},n.prototype.library=function(n,t){var r="/api/user/"+n.owner+"/library/"+encodeURIComponent(n.id),i=[];return t&&i.push("includeClones=true"),i.push("includeMetadata=true"),r+="?"+i.join("&"),this.$http.get(r).then(function(n){return n.data})},n.prototype.owner=function(n){var t="/api/libraries/"+encodeURIComponent(n)+"/owner";return this.$http.get(t).then(function(n){return n.data})},n.prototype.deleteFile=function(n,t){return this.$http.delete("/api/user/"+n.owner+"/library/"+encodeURIComponent(n.id)+"/files/"+encodeURIComponent(t)).then(function(n){return n.data})},n.prototype.ensureValidPath=function(n){return n&&n.trim()?(n=n.trim(),n.charAt(n.length-1)!="/"&&(n+="/")):n="",n},n.prototype.newFile=function(n,t,i,r,u){var e,f;t=this.ensureValidPath(u)+t;e=makeURL("/api/user/"+n.owner+"/library/"+encodeURIComponent(n.id)+"/files/"+encodeURIComponent(t),{overwrite:r,language:i});f="";switch(i){case"Python 2.7":f='{"nbformat_minor": 2, "cells": [{"execution_count": null, "cell_type": "code", "source": "", "outputs": [], "metadata": {"collapsed": true}}], "nbformat": 4, "metadata": {"kernelspec": {"display_name": "Python 2", "name": "python2", "language": "python"}, "language_info": {"mimetype": "text/ x - python", "nbconvert_exporter": "python", "version": "2.7.11", "name": "python", "file_extension": ".py", "pygments_lexer": "ipython2", "codemirror_mode": {"version": 2, "name": "ipython"}}}}';break;case"Python 3.5":f='{"nbformat_minor": 2, "cells": [{"execution_count": null, "cell_type": "code", "source": "", "outputs": [], "metadata": {"collapsed": true}}], "nbformat": 4, "metadata": {"kernelspec": {"display_name": "Python 3", "name": "python3", "language": "python"}, "language_info": {"mimetype": "text/ x - python", "nbconvert_exporter": "python", "version": "3.5.1", "name": "python", "file_extension": ".py", "pygments_lexer": "ipython2", "codemirror_mode": {"version": 2, "name": "ipython"}}}}';break;case"Python 3.6":f='{"nbformat_minor": 2, "cells": [{"execution_count": null, "cell_type": "code", "source": "", "outputs": [], "metadata": {"collapsed": true}}], "nbformat": 4, "metadata": {"kernelspec": {"display_name": "Python 3.6", "name": "python36", "language": "python"}, "language_info": {"mimetype": "text/ x - python", "nbconvert_exporter": "python", "version": "3.6.0", "name": "python", "file_extension": ".py", "pygments_lexer": "ipython2", "codemirror_mode": {"version": 2, "name": "ipython"}}}}';break;case"R":f='{"nbformat_minor": 2, "cells": [{"execution_count": null, "cell_type": "code", "source": "", "outputs": [], "metadata": {"collapsed": true}}], "nbformat": 4, "metadata": {"kernelspec": {"display_name": "R", "name": "r", "language": "R"}, "language_info": {"mimetype": "text/x-r-source", "version": "3.3.0", "name": "R", "pygments_lexer": "r", "file_extension": ".r", "codemirror_mode": "r"}}}';break;case"F#":f='{"nbformat_minor": 2, "cells": [{"execution_count": null, "cell_type": "code", "source": "", "outputs": [], "metadata": {"collapsed": true}}], "nbformat": 4, "metadata": {"kernelspec": {"display_name": "F#", "name": "ifsharp", "language": "fsharp"}, "language_info": {"mimetype": "text/ x - fsharp", "nbconvert_exporter": "", "version": "4.3.1.0", "name": "fsharp", "file_extension": ".fs", "pygments_lexer": "", "codemirror_mode": ""}, "language": "fsharp"}}';break;case undefined:case"Blank":f=""}return this.$http.post(e,f).then(function(n){return n.data})},n.prototype.uploadFile=function(n,t,i,r,u,f){var e,o,s;return f&&f.trim()&&(f=f.trim(),f.charAt(f.length-1)!="/"&&(f+="/"),t=f+t),e={language:r,overwrite:u,convert:undefined},r&&(e.convert=!0),o=makeURL("/api/user/"+n.owner+"/library/"+encodeURIComponent(n.id)+"/files/"+encodeURIComponent(t),e),s=this.$http.post(o,i).then(function(n){return n.data}),s},n.prototype.updateFile=function(n,t,i,r){var f,u;return r===void 0&&(r=undefined),f="/api/user/"+n.owner+"/library/"+encodeURIComponent(n.id)+"/files/"+encodeURIComponent(t),u={},r&&r!==t&&(u.headers={"X-Item-Rename":r}),this.$http.put(f,i,u).then(function(n){return n.data})},n.prototype.renameFile=function(n,t,i){var r="/api/user/"+n.owner+"/library/"+encodeURIComponent(n.id)+"/rename/"+encodeURIComponent(t);return this.$http.put(r,i).then(function(n){return n.data})},n.prototype.downloadFile=function(n,t){var i="/api/user/"+n.owner+"/library/"+encodeURIComponent(n.id)+"/files/"+encodeURIComponent(t);this.DownloadService.downloadUrl(i,t.slice(t.indexOf("/")+1),"application/octet-stream")},n.prototype.getFile=function(n,t,i){var r="/api/user/"+n.owner+"/library/"+encodeURIComponent(n.id)+"/files/"+encodeURIComponent(t);return i&&(r+="?encoding=base64"),this.$http.get(r,{responseType:"text",transformResponse:function(n){return n}}).then(function(n){return n.data})},n.prototype.getNotebook=function(n,t){var i="/api/user/"+n.owner+"/library/"+encodeURIComponent(n.id)+"/files/"+encodeURIComponent(t);return this.$http.get(i).then(function(n){return n.data})},n.prototype.diffFile=function(n,t,i){var r="/api/user/"+n.owner+"/library/"+encodeURIComponent(n.id)+"/diff/"+encodeURIComponent(i)+"?toLibrary="+t.id;return t.owner!==n.owner&&(r+="&toUser="+encodeURIComponent(t.owner)),this.$http.get(r).then(function(n){return n.data})},n.prototype.ensureHtml=function(n,t){var i=this.getHtmlUrl(n,t);return this.$http.patch(i,null).then(function(n){return n.data})},n.prototype.getHtmlUrl=function(n,t){return"/api/user/"+encodeURIComponent(n.owner)+"/library/"+encodeURIComponent(n.id)+"/html/"+encodeURIComponent(t)},n.prototype.getRawUrl=function(n,t){return"/"+encodeURIComponent(n.owner)+"/libraries/"+encodeURIComponent(n.id)+"/raw/"+encodeURIComponent(t)},n.prototype.downloadLibrary=function(n){var t="/api/user/"+encodeURIComponent(n.owner)+"/library/"+encodeURIComponent(n.id)+"/download";this.DownloadService.downloadUrl(t,n.name+".zip","application/zip",!0)},n.prototype.updateLibrary=function(n,t){var i="/api/user/"+t.owner+"/library/"+encodeURIComponent(n);return this.$http.put(i,t).then(function(n){return n.data})},n.prototype.deleteLibrary=function(n){var t="/api/user/"+n.owner+"/library/"+encodeURIComponent(n.id);return this.$http.delete(t).then(function(n){return n.data})},n.prototype.cloneLibraryAndNavigate=function(n){var t=this;this.UserService.checkSignedIn().then(function(i){if(i)t.library(n,!0).then(function(n){return n.owner==t.UserService.user.id&&(n.clones=n.clones.length==0?[n]:[n].concat(n.clones)),t.$uibModal.open({animation:!0,templateUrl:"/content/app/libraries/cloneLibrary.html",controller:"CloneLibraryController",controllerAs:"clone",resolve:{library:function(){return n},clones:function(){return n.clones}}})},function(){return t.$uibModal.open({animation:!0,templateUrl:"/content/app/libraries/notfound.html",controller:"LibraryNotFoundController",controllerAs:"$ctrl",resolve:{library:function(){return n}}})});else{var r="/"+encodeURIComponent(n.owner)+"/libraries/"+encodeURIComponent(n.id)+"?clone=true";t.UserService.signin(r)}})},n.prototype.runLibrary=function(n,t,i){var r=this;this.UserService.checkSignedIn().then(function(u){if(u||r.UserService.signin(),n.owner==r.UserService.user.id){var f=void 0;t&&(f="/notebooks/"+t);r.openServer(n,f,i);return}})},n.prototype.cloneAndRun=function(n,t,i,r){var u=this,f=n.id;this.UserService.checkSignedIn().then(function(i){if(i){if(n.owner==u.UserService.user.id){u.openServer(n,t);return}u.library(n,!0).then(function(n){return u.$uibModal.open({animation:!0,templateUrl:"/content/app/libraries/cloneLibrary.html",controller:"CloneLibraryController",controllerAs:"clone",resolve:{clones:function(){return n.clones},library:function(){return n}}})},function(){return u.$uibModal.open({animation:!0,templateUrl:"/content/app/libraries/notfound.html",controller:"LibraryNotFoundController",controllerAs:"$ctrl",resolve:{library:function(){return n}}})})}else r?u.navigateToDashboard(n):u.navigateToHtml(n,t)})},n.prototype.createServer=function(n){var t="/api/user/"+n.owner+"/library/"+n.id+"/start";return this.$http.post(t,undefined).then(function(n){return n.data},function(n){return{error:n.statusText}})},n.prototype.shutdown=function(n){var t="/api/user/"+n.owner+"/library/"+n.id+"/stop";return this.$http.post(t,undefined).then(function(n){return n.data},function(n){return{error:n.statusText}})},n.prototype.openServer=function(n,t,i){var r=this;this.createServer(n).then(function(u){r.connectToServer(u,t,n,i)})},n.prototype.checkCreationStatus=function(n){return this.$http.get("/api/notebooks/creation/"+n).then(function(n){return n.data})},n.prototype.cloneLibrary=function(n,t,i,r){var u={id:null,name:null,isPublic:null};return t&&(u.id=t),i&&(u.name=i),u.isPublic=r===undefined||r===null||r,this.$http.post("/api/user/"+encodeURIComponent(n.owner)+"/library/"+encodeURIComponent(n.id)+"/clone",u).then(function(n){return n.data},function(n){switch(n.status){case 400:n.data=n.statusText;break;case 404:n.data="The specified library no longer exists";break;case 409:n.data="The specified library ID is already in use";break;default:n.data="Unknown error: "+n.statusText}return{error:n.data}})},n.prototype.navigateTo=function(n,t,i){i?this.navigateToDashboard(n):this.navigateToNotebook(n,t)},n.prototype.navigateToNotebook=function(n,t){t?this.openServer(n,"/notebooks/"+t):this.openServer(n)},n.prototype.navigateToDashboard=function(n){this.$location.url("/"+n.owner+"/libraries/"+encodeURIComponent(n.id))},n.prototype.navigateToHtml=function(n,t){if(n){var i="/"+n.owner+"/libraries/"+n.id;t&&(i+="/html/"+t);this.$window.location.href=i}},n.prototype.connectToServer=function(n,t,i,r){var u=this,o;if(n.reconnected)o=n.url,o+=t?t:"/tree",this.$http.post(n.authUrl,undefined).then(function(){r?u.$window.open(o):u.$window.location.href=o});else var l=100,y=5e3/l,c=!1,a=!1,v=0,e={text:"Requesting a new notebook server...",warningText:undefined,ready:!1,error:!1,onReady:undefined,viewLog:i?function(){var n=i.owner+"/libraries/"+i.id+"/html/.nb.logs/.nb.setup.log";u.$window.open(n)}:undefined},f,s=!1,h=this.$interval(function(){u.checkCreationStatus(n.id).then(function(n){var l,k;if(!s){v+=1;v>y&&!a&&(a=!0,f=u.$uibModal.open({animation:!0,templateUrl:"/content/app/libraries/slow.html",controller:"SlowStartupController",controllerAs:"slow",resolve:{status:function(){return e}}}));var o=undefined,p=undefined,w=!1,b=!1;switch(n.status){case"Requesting":o="Requesting a new notebook server...";break;case"Initializing":o="Initializing...";break;case"ShuttingDownExisting":o="Shutting down your previous instance which is no longer responding...";break;case"ReservingContainer":o="Reserving a container for your notebook...";break;case"WaitingForHost":o="Creating additional system capacity to host your notebook...";break;case"SystemFull":o="The system is currently experiencing higher than normal usage.  We are unable to provide a free notebook at this time.  Please try again later...";break;case"StartingContainer":o="Starting a new container for your notebook...";break;case"WaitingForContainer":o="Waiting for your container to start...";break;case"Error":u.$interval.cancel(h);s=!0;console.log("canceled",h);f&&f.close();u.$uibModal.open({animation:!0,templateUrl:"/content/app/libraries/error.html",controller:NotebookStartupErrorController,controllerAs:"error",resolve:{message:function(){return n.error}}});break;case"PreparingContainer":o="Waiting for your container to finish being prepared...";p="Warning: Important preparation is in progress for your container.  You may enter now but your environment setup may still be in progress.";w=!0;l=n.baseUrl;l+=t?t:"/tree";e.onReady=function(){s=!0;u.$interval.cancel(h);c=!0;u.$http.post(n.auth_url,undefined).then(function(){r?(f&&f.dismiss("cancel"),u.$window.open(l)):u.$window.location.replace(l)})};break;case"Faulted":o="An error has occured while setting up your environment.";p="Error: Your container has been started, but an error has occured during setup, potentially your custom setup steps.";p+=i?"  Logs may be viewed below.":"  Logs may be viewed at .nb.logs/.nb.setup.log";b=!0;w=!0;break;case"Connected":w=!0;s=!0;u.$interval.cancel(h);c||(c=!0,l=n.baseUrl,t?(k=encodeURI(t),l+=k):l+="/tree",u.$http.post(n.auth_url,undefined).then(function(){r?(f&&f.dismiss("cancel"),u.$window.open(l)):u.$window.location.replace(l)}))}o&&(e.text=o,e.ready=w,e.error=b,e.warningText=p)}})},l)},n}();LibraryService.$inject=["$http","$window","UserService","DownloadService","$uibModal","$location","$interval"];angular.module("notebooks.libraries").service("LibraryService",LibraryService);AddFileController=function(){function n(n,t,i,r,u,f,e,o,s,h){var c=this;this.$uibModalInstance=n;this.library=t;this.$location=i;this.$http=r;this.LibraryService=u;this.$q=f;this.pageController=e;this.LogService=o;this.$scope=s;this.AddFileService=h;s.$on("closeDialog",function(){c.pageController.refresh();c.$uibModalInstance.close()})}return n.prototype.cancel=function(){this.$uibModalInstance.dismiss("cancel")},n}();AddFileController.$inject=["$uibModalInstance","library","$location","$http","LibraryService","$q","pageController","LogService","$scope","AddFileService"];AddFileService=function(){function n(){this.NotebookNamePlaceHolder="New Notebook.ipynb";this.languages=[{name:"Python 2.7"},{name:"Python 3.5"},{name:"Python 3.6"},{name:"R"},{name:"F#"}]}return n.prototype.getFileNameFromUrl=function(n){if(n){var t=n.split("/"),i=t[t.length-1];return i.split("?")[0]}},n.isIpynbExtension=function(t){return String(t).toLowerCase().substr(-n.notebookSuffix.length)===n.notebookSuffix},n.prototype.isValid=function(t){return t?(String(t).toLowerCase().substr(-n.notebookSuffix.length)===n.notebookSuffix)?/[#\\/?\*:<>|]/.test(t)?{statusClass:"error",status:"Filenames cannot contain the following characters: /, \\, #, ?, *, :, <, >, |",valid:!1}:{statusClass:"status",status:"",valid:!0}:{statusClass:"error",status:"Filename must end in .ipynb",valid:!1}:{statusClass:"error",status:"Filename must be specified",valid:!1}},n.prototype.isMarkdown=function(n){if(!n)return!1;var t="",i=n.lastIndexOf(".");return i>=0&&(t=n.substring(i+1)),t.toLowerCase()=="md"},n}();AddFileService.notebookSuffix=".ipynb";AddFileService.markdownSuffix=".md";angular.module("notebooks.libraries").controller("AddFileController",AddFileController).service("AddFileService",AddFileService);AddFileBlankController=function(){function n(n,t,i,r){this.$scope=n;this.$http=t;this.LibraryService=i;this.AddFileService=r;this.language=""}return n.prototype.createNew=function(n,t){var i=this;i.$http.get("",{transformResponse:[function(n){return n}]}).then(function(){i.LibraryService.newFile(i.library,i.filename,n||undefined,t,i.path).then(function(){i.urlConflict=!1;i.close()},function(n){n.statusText=="Conflict"&&n.data==="File exists"?i.urlConflict=!0:(i.status="Failure while creating file: "+n.data,i.statusClass="error")})},function(n){i.status="Error while creating new notebook: "+n.statusText;i.statusClass="error"})},n.prototype.isValid=function(){var n=this.AddFileService.isValid(this.filename);return n.valid||(this.status=n.status,this.statusClass=n.statusClass),n.valid},n.prototype.onBlurValidate=function(){var n=this.$scope.addFileForm,t=this.filename,i;t&&(i=AddFileService.isIpynbExtension(t),this.language?(n.language.$setValidity("ipynbNeedsLanguage",!0),t.indexOf(".")==-1?this.filename+=".ipynb":n.filename.$setValidity("filenameMustEndInIpynb",i)):(n.language.$setValidity("ipynbNeedsLanguage",!i),n.filename.$setValidity("filenameMustEndInIpynb",!0)));n.filename.$setValidity("filenameInvalidCharacters",!/[#\\/?\*:<>|]/.test(t))},n.prototype.close=function(){this.$scope.$emit("closeDialog")},n}();AddFileBlankController.$inject=["$scope","$http","LibraryService","AddFileService"];AddFileUrlController=function(){function n(n,t,i,r,u){this.$scope=n;this.$http=t;this.LogService=i;this.LibraryService=r;this.AddFileService=u;this.uploadUrl=""}return n.prototype.uploadFromUrl=function(n){var t=this,r=t.uploadUrl,i=/([^\/]*\/\/)([^\/]*)\/([^\/]*)\/([^\/]*)\/blob\/(.*)/i.exec(t.uploadUrl);i!=null&&i[2].toLowerCase().indexOf("github.com")!=-1&&(r=i[1]+"raw.githubusercontent.com/"+i[3]+"/"+i[4]+"/"+i[5]);t.$http.get(r,{transformResponse:[function(n){return n}]}).then(function(i){var u=i.data,f;if(AddFileService.isIpynbExtension(r))try{JSON.parse(u)}catch(e){t.status="This file doesn't appear to be a notebook file. Please verify that the link you provided is to an ipynb file.";t.statusClass="error";return}t.language&&(f=t.language.name);t.LibraryService.uploadFile(t.library,t.filename,u,f,n,t.path).then(function(){t.urlConflict=!1;t.close()},function(n){n.statusText=="Conflict"?t.urlConflict=!0:(t.status="Failure while uploading file: "+n.data,t.statusClass="error")})},function(n){var i=n.statusText;i||(i="Notebook does not exist at target URL, or target site has not given us permission to download it.  If the file is accessible via other means, please try uploading from computer.",t.LogService.metric("Event.AddFile.UploadFromUrl.NullStatusFailure",1,{url:t.uploadUrl}));t.status="Error while downloading notebook: "+i;t.statusClass="error"})},n.prototype.onBlurValidateFilename=function(){var t=this.$scope.addFileForm,n=this.filename;n&&t.filename.$setValidity("filenameInvalidCharacters",!/[#\\/?\*:<>|]/.test(n))},n.prototype.onBlur=function(){this.uploadUrl&&(this.filename=this.AddFileService.getFileNameFromUrl(this.uploadUrl))},n.prototype.close=function(){this.$scope.$emit("closeDialog")},n}();AddFileUrlController.$inject=["$scope","$http","LogService","LibraryService","AddFileService"];AddFileLocalController=function(){function n(n,t,i){var r=this;this.$scope=n;this.LibraryService=t;this.AddFileService=i;this.updateFiles=function(){for(var n=0;n<r.files.length;n++)r.onBlur(n)}}return n.prototype.overwrite=function(n,t,i){var r=this;this.LibraryService.uploadFile(this.library,this.fileNames[n],t,i,!0).then(function(){r.fileStatus[n].overwrite=!1;r.fileStatus[n].success=!0;r.checkAllUploadedAndClose()},function(t){r.fileStatus[n].error=t.statusText})},n.prototype.upload=function(){var i=this,r,t,n;for(this.fileStatus=new Array(this.files.length),n=0;n<this.files.length;n++)this.fileStatus[n]={error:undefined,success:!1,overwrite:!1};for(r=function(n){var r=void 0;t.languages&&(r=t.languages[n].name);t.LibraryService.uploadFile(t.library,t.fileNames[n],t.files[n],r,undefined,t.path).then(function(){i.fileStatus[n].success=!0;i.checkAllUploadedAndClose()},function(t){switch(t.statusText){case"Conflict":i.fileStatus[n].overwrite=!0;break;default:i.fileStatus[n].error=t.statusText}})},t=this,n=0;n<this.files.length;n++)r(n)},n.prototype.checkAllUploadedAndClose=function(){for(var i=!0,r,n=0,t=this.fileStatus;n<t.length;n++)if(r=t[n],!r.success){i=!1;break}i&&this.close()},n.prototype.onBlurValidateFilename=function(n){var t=this.$scope.addFileForm,i=this.fileNames[n];t.fileNames[n].$setValidity("filenameInvalidCharacters",!/[#\\/?\*:<>|]/.test(i))},n.prototype.onBlur=function(n){this.files[n]&&(this.fileNames[n]=this.files[n].name)},n.prototype.close=function(){this.$scope.$emit("closeDialog")},n}();AddFileLocalController.$inject=["$scope","LibraryService","AddFileService"];angular.module("notebooks.libraries").directive("addFileBlank",function(){return{restrict:"E",controller:AddFileBlankController,controllerAs:"$ctrl",scope:{library:"<",path:"<"},bindToController:!0,templateUrl:"/content/app/libraries/addFileBlank.html"}}).directive("addFileUrl",function(){return{restrict:"E",controller:AddFileUrlController,controllerAs:"$ctrl",scope:{library:"<",path:"<"},bindToController:!0,templateUrl:"/content/app/libraries/addFileUrl.html"}}).directive("addFileLocal",function(){return{restrict:"E",controller:AddFileLocalController,controllerAs:"$ctrl",scope:{library:"<",path:"<"},bindToController:!0,templateUrl:"/content/app/libraries/addFileLocal.html"}});angular.module("notebooks.libraries").controller("CloneController",["library",function(){}]);CloneLibraryController=function(){function n(n,t,i,r,u,f,e){var s=this,o,h;if(this.library=n,this.clones=t,this.$uibModalInstance=i,this.$uibModal=r,this.LibraryService=u,this.UserService=f,this.$location=e,this.baseLibraryUrl=this.$location.protocol()+"://"+this.$location.host()+"/"+this.UserService.user.id+"/libraries/",this.newLibraryId=n.id,this.newLibraryName=n.name,this.newLibraryPublic=n.public,t&&t.length>0){o=t.length;h=function(){for(var n=0;n<t.length;n++)if(t[n].name==s.newLibraryName||t[n].id==s.newLibraryId)return!0;return!1};do this.newLibraryId=n.id+"-"+o,this.newLibraryName=n.name+" ("+o+")",o++;while(h())}}return n.prototype.close=function(){this.$uibModalInstance.dismiss("cancel")},n.prototype.openClone=function(n){this.$uibModalInstance.close();this.LibraryService.navigateTo(n,null,!0)},n.prototype.createFromClone=function(){var n=this;return this.processing=!0,this.error="",this.LibraryService.cloneLibrary(this.library,this.newLibraryId,this.newLibraryName,this.newLibraryPublic).then(function(t){n.processing=!1;t.error?n.error=t.error:(n.$uibModalInstance.close(),n.LibraryService.navigateTo(t,null,!0))})},n}();CloneLibraryController.$inject=["library","clones","$uibModalInstance","$uibModal","LibraryService","UserService","$location"];angular.module("notebooks.libraries").controller("CloneLibraryController",CloneLibraryController);CreateServerController=function(){function n(n,t,i,r,u,f){if(this.$http=n,this.LibraryService=t,this.$window=i,this.$location=r,this.creation=u,this.library=f,this.creation.error){switch(this.creation.error){case"Unknown library":this.error="This library does not exist.";break;case"Unknown user":this.error="This user does not exist, so we can't find the specified library.";break;default:this.error=u.error}return}t.connectToServer(this.creation,r.search().dest,f)}return n}();CreateServerController.$inject=["$http","LibraryService","$window","$location","creation","library"];angular.module("notebooks.libraries").controller("CreateServerController",CreateServerController);DeleteLibraryController=function(){function n(n,t,i,r){this.$uibModalInstance=n;this.library=t;this.LibraryService=i;this.dashboard=r}return n.prototype.del=function(){var n=this;this.LibraryService.deleteLibrary(this.library).then(function(){n.dashboard.remove(n.library);n.$uibModalInstance.close()},function(t){n.error=t.status==404?"The specified library no longer exists":t.statusText})},n.prototype.cancel=function(){this.$uibModalInstance.dismiss("cancel")},n}();DeleteLibraryController.$inject=["$uibModalInstance","library","LibraryService","dashboard"];angular.module("notebooks.libraries").controller("DeleteLibraryController",DeleteLibraryController);DeleteNotebookController=function(){function n(n,t,i,r,u){this.$uibModalInstance=n;this.removeNotebook=t;this.library=i;this.notebook=r;this.LibraryService=u}return n.prototype.del=function(){var n=this;this.LibraryService.deleteFile(this.library,this.notebook.path).then(function(){n.removeNotebook(n.notebook);n.$uibModalInstance.close()},function(t){n.error=t.data})},n.prototype.cancel=function(){this.$uibModalInstance.dismiss("cancel")},n}();DeleteNotebookController.$inject=["$uibModalInstance","removeNotebook","library","notebook","LibraryService"];angular.module("notebooks.libraries").controller("DeleteNotebookController",DeleteNotebookController);EditLibraryController=function(){function n(n,t,i,r,u,f){var o=this,e;this.$uibModalInstance=n;this.library=t;this.$location=i;this.LibraryService=r;this.baseLibraryUrl=u;this.$scope=f;this.activeTab=0;this.setupStepTypes={"Requirements.txt":{operation:"Requirements.txt",options:{"Python Version":["2.7","3","3.6"]},compile:function(n,t){var i=t["Python Version"],r={"2.7":"/home/nbuser/anaconda2_501/bin/pip","3":"/home/nbuser/anaconda3_420/bin/pip","3.6":"/home/nbuser/anaconda3_501/bin/pip"},u;return(i&&r.hasOwnProperty(i))?(u=r[i],u+" install -r "+n):""}},"Shell Script":{operation:"Shell Script",options:{},compile:function(n){return"/bin/bash "+n}}};this.error=null;this.host=i.host();this.dismiss="cancel";this.oldId=t.id;this.idRequired=this.library.owner?!0:!1;this.library.setupSteps||(this.library.setupSteps=[]);e=function(n){o.preventModalClose&&n.preventDefault()};f.$on("modal.closing",e)}return n.prototype.initializeNewSetupStep=function(){this.library.setupSteps.push({operation:undefined,targetPath:undefined,position:undefined,options:{}});return},n.prototype.removeSetupStep=function(n){var t=this;t.library.setupSteps.splice(t.library.setupSteps.indexOf(n),1)},n.prototype.doesStepTargetExist=function(n){var t=this;return t.library.files.some(function(t){return n.targetPath===t.path})},n.prototype.save=function(){var n=this,t,i,r;if(this.library.setupSteps.some(function(t){return t.operation===undefined||t.targetPath===undefined||Object.keys(n.setupStepTypes[t.operation].options).some(function(n){return t.options[n]===undefined})||!n.doesStepTargetExist(t)})){this.error="Environment setup steps must have all fields populated with values.";return}t=0;for(i in this.library.setupSteps)r=this.library.setupSteps[i],r.position=t,t++;this.LibraryService.updateLibrary(this.oldId,this.library).then(function(){n.$uibModalInstance.close()},function(t){switch(t.status){case 400:n.error=t.statusText;break;case 404:n.error="The specified library no longer exists";n.dismiss="deleted";break;case 409:n.error="The specified library ID is already in use";break;default:n.error="Unknown error: "+t.statusText}})},n.prototype.cancel=function(){this.$uibModalInstance.dismiss(this.dismiss)},n}();EditLibraryController.$inject=["$uibModalInstance","library","$location","LibraryService","baseLibraryUrl","$scope"];angular.module("notebooks.libraries").controller("EditLibraryController",EditLibraryController);NotebookStartupErrorController=function(){function n(n,t){this.message=n;this.$uibModalInstance=t}return n.prototype.close=function(){this.$uibModalInstance.close()},n}();NotebookStartupErrorController.$inject=["message","$uibModalInstance"];LibraryHtmlController=function(){function n(n,t,i,r,u,f,e,o,s){var h=this,a,v,c,y,p,w,l;this.LibraryService=n;this.UserService=t;this.DialogService=i;this.LogService=r;this.library=u;this.file=f;this.isHome=e;this.$scope=o;this.$location=s;this.contextHelpLink="/help/libraries/library-view/html-preview";this.pathParts=[];this.url=n.getHtmlUrl(u,f);this.raw=n.getRawUrl(u,f);a=this.$location.hash();a&&(this.url+="#"+a);this.loaded=!1;this.file=f;this.library=u;this.signedIn=this.UserService.user.signedIn;this.framed=!1;v=f.lastIndexOf(".");v!=-1&&(c=f.substr(v+1).toLowerCase(),c=="ipynb"||c=="html"||c=="htm"?this.framed=!0:UserLibraryController.ExtensionToIcon[c]=="notebook-icon-image"&&(this.image=!0));y=this.file.split("/");p="tree";for(w in y)l=y[w],l&&(p+="/"+l,this.pathParts.push({path:p,name:l}));this.keyBindings={s:function(){return h.share(h.library)},c:function(){return h.clone()},l:function(){return h.$location.url("/"+h.library.owner+"/libraries/"+h.library.id+"/clones")},r:function(){return h.run()},d:function(){return h.downloadFile(h.file)}};this.framed?n.ensureHtml(u,f).then(function(){h.loaded=!0},function(n){h.error=!0;n.status==400?h.errorText="The file you are trying to preview is not supported.":n.status==413&&(h.errorText="The file you are trying to preview is too large to be viewed.")}):this.image?this.loaded=!0:this.LibraryService.getFile(this.library,this.file).then(function(n){h.content=n;h.loaded=!0});this.isOwner=u.isOwner}return n.prototype.$onInit=function(){console.log("oninit")},n.prototype.clone=function(){this.LibraryService.cloneLibraryAndNavigate(this.library)},n.prototype.run=function(){this.LibraryService.runLibrary(this.library,this.file)},n.prototype.downloadFile=function(n){this.LogService.metric("Command.UserLibraries.FileDownloaded",1,{library:this.library.id,file:n});this.LibraryService.downloadFile(this.library,n)},n.prototype.share=function(n){var i=this,t;this.LogService.metric("Command.UserLibraries.Share",1,{library:n.id});t=this.DialogService.openShare(n);t.result.then(function(){i.$scope.$broadcast("focusOnShareLibrary")})},n}();LibraryHtmlController.$inject=["LibraryService","UserService","DialogService","LogService","library","file","isHome","$scope","$location"];angular.module("notebooks.libraries").controller("LibraryHtmlController",LibraryHtmlController).directive("htmlFrame",["$interval",function(n){return{restrict:"E",templateUrl:"/content/app/libraries/htmlFrame.html",scope:{url:"="},link:function(t,i){var r=i.find("iframe")[0],u=!1,f;t.resizeFrame=function(){var n,t,i,f;n=r.document!==undefined?r.document.body:r.contentWindow.document.body;t=r;n&&(i=n.scrollHeight+(n.offsetHeight-n.clientHeight)+"px",f=n.scrollWidth+(n.offsetWidth-n.clientWidth)+"px",i>t.style.height||f>t.style.width?(t.style.height="100%",t.style.width="100%",t.style.height=parseInt(i.slice(0,-2))+10+"px",t.style.width=f):u||(r.contentWindow.scrollToFragment(),u=!0))};r.onload=function(){t.resizeFrame();f=n(function(){t.resizeFrame()},250);t.$on("$destroy",function(){n.cancel(f)})};r.src=t.url}}}]);LibraryController=function(){function n(n){this.library=n;var t=this;this.error=n.error}return n}();LibraryController.$inject=["library"];angular.module("notebooks.libraries").controller("LibraryController",LibraryController);NewLibraryController=function(){function n(n,t,i,r,u,f,e){if(this.$uibModalInstance=n,this.LibraryService=t,this.UserService=i,this.dashboard=r,this.baseLibraryUrl=u,this.userId=f,this.gitRepository=e,this.library={name:"",description:"",id:"","public":!0,owner:f,readme:!0},this.idPlaceholder="Unique id used for sharing (required)",this.gitRepositoryPlaceholder="Git repo (required)",this.submitStatusDefault="Please wait...  Importing content from Git takes some time",this.gitRemoteBaseUrl="https://github.com/",this.idRequired=!0,this.submitDisabled=!1,this.indextab=0,this.gitRepository){this.library.gitRepositoryName=this.gitRepository;this.trimGitRepositoryName();var o=this.library.gitRepositoryName;this.library.name=o.substr(o.lastIndexOf("/")+1);this.library.id=o.replace("/","-").substr(0,30);this.indextab=1}}return n.prototype.create=function(){var n=this,t;this.error=undefined;this.library.gitRemoteUrl=this.gitRemoteBaseUrl;t=this.UserService.newLibrary(this.userId,this.library);this.submitDisabled=!0;this.status=this.submitStatusDefault;t.then(function(t){t.error?n.error=t.error:(n.dashboard.items.all.push(t),n.$uibModalInstance.close(t));n.submitDisabled=!1})},n.prototype.isGitSubmitDisabled=function(){return!(this.library.gitRepositoryName&&(this.library.id||!this.idRequired))||this.submitDisabled},n.prototype.trimGitRepositoryName=function(){var n=this;n.library.gitRepositoryName.indexOf("github.com/")!==-1&&(n.library.gitRepositoryName=n.library.gitRepositoryName.split("github.com/")[1])},n.prototype.cancel=function(){this.$uibModalInstance.dismiss("cancel")},n}();NewLibraryController.$inject=["$uibModalInstance","LibraryService","UserService","dashboard","baseLibraryUrl","userId","gitRepository"];angular.module("notebooks.libraries").controller("NewLibraryController",NewLibraryController);LibraryNotFoundController=function(){function n(n,t){this.library=n;this.$uibModalInstance=t}return n.prototype.close=function(){this.$uibModalInstance.dismiss("cancel")},n}();LibraryNotFoundController.$inject=["library","$uibModalInstance"];angular.module("notebooks.libraries").controller("LibraryNotFoundController",LibraryNotFoundController);ShareLibraryController=function(){function n(n,t,i,r){this.$uibModalInstance=n;this.library=t;this.$location=i;this.$window=r;this.link=i.protocol()+"://"+i.host()+"/"+this.library.owner+"/libraries/"+t.id;this.host=i.protocol()+"://"+i.host();this.to={message:"",email:[]}}return n.prototype.close=function(){this.$uibModalInstance.close()},n.prototype.sendMail=function(){var t=this.to.message,r,i;t&&(t="%0D%0A"+t+"%0D%0A");r="Hey,%0D%0A"+t+"%0D%0ACheck out my Azure Notebook Library at "+this.link;i=[];this.to.email.forEach(function(n){i.push(n.text)});var u=i.join(";"),f="mailto:"+u+"?subject=Check out my Azure Notebooks Library!&body="+r,n=this.$window.open(f,"emailWindow");n&&n.open&&!n.closed&&n.setTimeout(function(){n.close()},500);this.$uibModalInstance.close()},n}();ShareLibraryController.$inject=["$uibModalInstance","library","$location","$window"];angular.module("notebooks.libraries").controller("ShareLibraryController",ShareLibraryController);ShutdownLibraryController=function(){function n(n,t,i){this.$uibModalInstance=n;this.library=t;this.LibraryService=i}return n.prototype.shutdown=function(){var n=this;this.LibraryService.shutdown(this.library).then(function(t){t&&t.error?n.error=t.error:(n.library.isRunning=!1,n.$uibModalInstance.close())})},n.prototype.cancel=function(){this.$uibModalInstance.close()},n}();ShutdownLibraryController.$inject=["$uibModalInstance","library","LibraryService"];SlowStartupController=function(){function n(n,t){this.close=function(){var n=this;n.$uibModalInstance.close()};var i=this;i.status=n;i.$uibModalInstance=t}return n}();SlowStartupController.$inject=["status","$uibModalInstance"];angular.module("notebooks.libraries").controller("SlowStartupController",SlowStartupController);HelpController=function(){function n(n,t,i,r){var u=this;this.LibraryService=n;this.site=t.protocol()+"://"+t.host();this.breadcrumb=[{text:"Help",url:"/help"}];this.children=[];this.searchEmpty=!1;this.noTopic=!1;Object.defineProperty(this,"_searchStr",i.makeSearchProxyDescriptor("search",SearchSerializers.DefaultString("")));r.$watch(function(){return u.children.length},function(){var t,n,i,r;for(u._searchStr&&u.initSearchTerms(),t=!1,n=0,i=u.children;n<i.length;n++)if(r=i[n],r.isTopicSelected){t=!0;break}t||(u.noTopic=!0)})}return Object.defineProperty(n.prototype,"search",{get:function(){return this._searchStr},set:function(n){this._searchStr=n;this.initSearchTerms()},enumerable:!0,configurable:!0}),n.prototype.initSearchTerms=function(){var t,i,r;if(this.searchTerms=n.normalizeSearch(this._searchStr),this.searchTerms.length){for(this.searchEmpty=!0,t=0,i=this.children;t<i.length;t++)if(r=i[t],r.searchMatches()){this.searchEmpty=!1;break}}else this.searchEmpty=!1},n.prototype.indexContent=function(t,i){for(var o=n.normalizeSearch(t),r=i,u,f,e;r;){for(u=0,f=o;u<f.length;u++)e=f[u],r.terms[e]=null;r=r.parent}},n.normalizeSearch=function(t){return t.split(/[ \n:,\(\)\+]/).map(function(n){return n.toLowerCase().replace(/[\.\?\-]$/,"").replace(/['\-]/,"")}).filter(function(t){return!!t&&t.length>1&&!(t in n.stopWords)}).map(n.singularize)},n.singularize=function(t){var r=t.substr(-3,3),i;return r=="ies"?t.substr(0,t.length-3)+"y":(i=t.substr(-2,2),i=="es")?t.substr(0,t.length-1):t[t.length-1]=="s"?t.substr(0,t.length-1):n.transforms[t]||t},n}();HelpController.$inject=["LibraryService","$location","SearchProxyService","$scope"];HelpController.transforms={actively:"active",accidently:"accident",automatically:"automatic",changing:"change",cloning:"clone",comparing:"compare",configuring:"configure",currently:"current",deleting:"delete",directly:"direct",downloaded:"download",downloading:"download",editing:"edit",enabling:"enable",executing:"execute","finally":"final",following:"follow",friendly:"friend",including:"include",installed:"install",installing:"install",interested:"interest",learning:"learn",locally:"local",logging:"log",manually:"manual",permanently:"permanent",pressing:"press",publicly:"public",running:"run",selecting:"select",storing:"store",supporting:"support",teaching:"teach",troubleshooting:"troubleshoot",uploaded:"upload",uploading:"upload",visiting:"visit"};HelpController.stopWords={a:null,an:null,and:null,are:null,as:null,at:null,be:null,by:null,but:null,can:null,"do":null,each:null,easy:null,easily:null,"for":null,from:null,has:null,"if":null,"in":null,is:null,it:null,its:null,may:null,not:null,of:null,on:null,or:null,than:null,that:null,the:null,then:null,they:null,"this":null,to:null,us:null,you:null};HelpTopicController=function(){function n(n){this.$route=n;this.curPath=n.current.params.path;this.children=[];this.terms={}}return n.prototype.addChild=function(n){this.children.push(n)},n.prototype.$onInit=function(){this.curPath==this.fullPath&&(this.page.breadcrumb=this.makeBreadCrumb())},n.prototype.makeBreadCrumb=function(){var t=[],n;for(t.push({text:this.helpTopic}),n=this.parent;n;)t.push({text:n.helpTopic,url:n.url}),n=n.parent;return t.push({text:"Help",url:"/help"}),t.reverse(),t},Object.defineProperty(n.prototype,"showHeading",{get:function(){return this.curPath?this.fullPath.lastIndexOf(this.curPath,0)===0:!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hyperlink",{get:function(){return this.fullPath!=this.curPath},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"showBreak",{get:function(){return this.curPath?this.fullPath.length>=this.curPath.length?this.fullPath.indexOf("/",this.curPath.length+1)==-1:!1:!this.parent},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"url",{get:function(){return"/help/"+this.fullPath},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fullPath",{get:function(){var n=this.helpTopic.toLowerCase().replace(/ /g,"-").replace(/[^a-z0-9-]/g,"");return this.parent!=null?this.parent.fullPath+"/"+n:n},enumerable:!0,configurable:!0}),n.prototype.searchMatches=function(){for(var i=0,r,n=0,t=this.page.searchTerms;n<t.length;n++)r=t[n],r in this.terms&&i++;return i!=this.page.searchTerms.length?!1:!0},Object.defineProperty(n.prototype,"visible",{get:function(){return this.page.searchTerms&&this.page.searchTerms.length&&!this.searchMatches()?!1:this.isTopicSelected},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isTopicSelected",{get:function(){var n=this.$route.current.params.path;return n?this.fullPath.lastIndexOf(n+"/",0)===0?!0:n.lastIndexOf(this.fullPath,0)===0?!0:!1:!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"listClass",{get:function(){var n="",t;return(this.children.length!=0&&(n="help-heading-spacer "),!this.curPath)?n+"help-question-list":(t=this.$route.current.params.path,t&&this.fullPath.indexOf("/",t.length+1)!=-1)?n+"help-question-list":n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"headingClass",{get:function(){for(var t=0,i=this.parent,r,n;i!=null;)i=i.parent,t++;if(r=this.$route.current.params.path,r)for(n=0;(n=r.indexOf("/",n))!=-1;)t--,n++;switch(t){case 0:return"help-heading-topic";case 1:return"help-heading-section";case 2:return"help-heading-subsection";case 3:return"help-heading-subsubsection"}},enumerable:!0,configurable:!0}),n}();HelpTopicController.$inject=["$route"];HelpDetailsController=function(){function n(n){this.$route=n}return Object.defineProperty(n.prototype,"visible",{get:function(){var n=this.$route.current.params.path;return n===this.parent.fullPath},enumerable:!0,configurable:!0}),n}();HelpDetailsController.$inject=["$route"];HelpSummaryController=function(){function n(n){this.$route=n}return Object.defineProperty(n.prototype,"visible",{get:function(){var n=this.$route.current.params.path;return n?this.parent.fullPath.lastIndexOf(n,0)===0:!1},enumerable:!0,configurable:!0}),n}();HelpSummaryController.$inject=["$route"];HelpLinkController=function(){function n(){}return n}();HelpLinkController.$inject=[];angular.module("notebooks.help",["ngRoute"]).config(["$routeProvider",function(n){n.when("/help",{templateUrl:"/content/app/help/help.html",reloadOnSearch:!1})}]).config(["$routeProvider",function(n){n.when("/help/:path*",{templateUrl:"/content/app/help/help.html",reloadOnSearch:!1})}]).directive("helpPage",function(){return{restrict:"A",controller:HelpController,controllerAs:"$ctrl",bindToController:!0}}).directive("helpTopic",function(){return{restrict:"A",controller:HelpTopicController,controllerAs:"$ctrl",bindToController:!0,require:{self:"helpTopic",parent:"?^^helpTopic",page:"^^helpPage"},template:'<div ng-show="$ctrl.visible"><div ng-if="$ctrl.showBreak" class="help-group-start"><div ng-class="$ctrl.headingClass"><a ng-if="$ctrl.hyperlink" href="{{$ctrl.url}}">{{$ctrl.helpTopic}}<\/a><span ng-if="!$ctrl.hyperlink">{{$ctrl.helpTopic}}<\/span><\/div><hr class="help-break" /><ng-transclude><\/ng-transclude><\/div><div ng-if="!$ctrl.showBreak"><div ng-class="$ctrl.listClass"><div ng-class="$ctrl.headingClass" ng-if="$ctrl.showHeading"><a href="{{$ctrl.url}}">{{$ctrl.helpTopic}}<\/a><\/div><ng-transclude><\/ng-transclude><\/div><\/div><\/div>',transclude:!0,link:function(n,t,i,r){r.self.parent=r.parent;r.self.page=r.page;r.parent&&r.parent.addChild(r.self);r.page.children.push(r.self);r.page.indexContent(r.self.helpTopic,r.self)},scope:{helpTopic:"@"}}}).directive("helpLink",function(){return{restrict:"AE",controller:HelpLinkController,controllerAs:"$ctrl",bindToController:!0,templateUrl:"/content/app/help/helpLink.html",scope:{helpLink:"@"}}}).directive("helpDetails",function(){return{restrict:"AE",controller:HelpDetailsController,controllerAs:"$ctrl",bindToController:!0,transclude:!0,scope:{},require:{self:"helpDetails",parent:"?^^helpTopic",page:"^^helpPage"},link:function(n,t,i,r){r.self.parent=r.parent;r.page.indexContent(t.text(),r.self.parent)},template:'<div ng-show="$ctrl.visible"><ng-transclude><\/ng-transclude><\/div>'}}).directive("helpSummary",function(){return{restrict:"AE",controller:HelpSummaryController,controllerAs:"$ctrl",bindToController:!0,transclude:!0,scope:{},require:{self:"helpSummary",parent:"?^^helpTopic",page:"^^helpPage"},link:function(n,t,i,r){r.self.parent=r.parent;r.page.indexContent(t.text(),r.self.parent)},template:'<div ng-show="$ctrl.visible"><p><ng-transclude><\/ng-transclude><\/p><\/div>'}});IndexController=function(){function n(t,i,r,u,f){var e=this,o;this.LibraryService=t;this.UserService=i;this.$window=r;this.LogService=u;this.SamplesService=f;f.samples().then(function(t){t?i.getCards(t).then(function(n){e.samples=n}):e.samples=n.defaultSamples});f.featuredContent().then(function(n){n&&(e.featuredContent=n)});o=r.navigator.userAgent;this.isIE=o.indexOf("Trident")!=-1}return n.prototype.computeSampleCardClass=function(n){switch(n){case 4:return"col-md-3";case 3:return"col-md-4";case 2:return"col-md-6";case 1:return"col-md-12";default:return"col-md-12"}},n.prototype.openSample=function(n){this.LogService.metric("SampleOpened",1,{library:n.library,notebook:n.notebook});this.LibraryService.navigateToHtml({id:n.library,owner:n.owner},n.notebook)},n}();IndexController.$inject=["LibraryService","UserService","$window","LogService","SettingsService"];IndexController.defaultSamples=[[{name:"Introduction to<br />Python",owner:"Microsoft",img:"/Content/landing-page/pythonintro.png",description:"Learn the basics of Python 3 in Azure Notebooks. Learn Python syntax, standard data types, as well as how to write a simple program.",library:"samples",notebook:"Introduction to Python.ipynb"},{name:"Introduction to<br />R",owner:"Microsoft",img:"/content/landing-page/rintro.svg",description:"Get a brief introduction to charting and graphing capabilities of R in the Jupyter Notebook. You will learn how to make line charts, pie charts and scatter plots.",library:"samples",notebook:"Introduction to R.ipynb"},{name:"Introduction to<br />F#",owner:"Microsoft",img:"/content/landing-page/FSharp.Azure.Logo.png",description:"Get a brief introduction to using F# in the Jupyter Notebook.",library:"fsharp",notebook:"FSharp for Azure Notebooks.ipynb"},{name:"Introduction to<br />Python3",owner:"Microsoft",img:"/Content/landing-page/pythonintro.png",description:"Learn the basics of Python 3 in Azure Notebooks. Learn Python syntax, standard data types, as well as how to write a simple program.",library:"samples",notebook:"Introduction to Python.ipynb"},],[{name:"Getting to your data in Azure Notebooks",owner:"Microsoft",img:"/content/landing-page/WindowsAzure.png",description:"There are many ways to fetch your data within a Jupyter Notebook. This sample aims to show you a few different ways of doing so.",library:"samples",notebook:"Getting to your Data in Azure Notebooks.ipynb"},{name:"Discover Sentiments in Tweets",owner:"Microsoft",img:"/content/landing-page/twittertopics.png",description:"Notebooks can allow anyone with a social media account to gain a greater understanding about customers and communities by analyzing social feeds.",library:"samples",notebook:"Discover Sentiments in Tweets.ipynb"},{name:"Introduction to Cognitive Toolkit (CNTK)",owner:"cntk",img:"/content/landing-page/cntk.png",description:"Learn the basics of CNTK, Microsoft’s commercial grade deep learning toolkit.  Use our Python notebooks and learn how harness the power of AI algorithms with uncompromised scaling, speed and accuracy.",library:"tutorials",notebook:undefined},],[{name:"Create & Deploy an Intelligent Cloud Service",owner:"Microsoft",img:"/content/landing-page/MLIcon.png",description:"Unlock the power in your data by training intelligent apps and services using Azure ML. This sample notebook uses research data to train a model to predict body temperatures of mammals in Wisconsin.",library:"samples",notebook:"Creation and Deployment of an Azure ML Web Service.ipynb"},{name:"Fundamentals of Data Science with Python",owner:"rheartpython",img:"/content/landing-page/pythonintro.png",description:"A core course in language fundamentals, data analysis, and machine learning from Microsoft’s Data Scientists. Learn how to write basic programs in Python.",library:"PythonDS101",notebook:undefined},{name:"Predictive Maintenance in Manufacturing",owner:"Microsoft",img:"/content/landing-page/WindowsAzure.png",description:"Businesses are interested in predicting problems in advance so that they can proactively prevent them from impacting production and customers. This sample implements a predictive model for component failure.",library:"PredictiveMaintenance",notebook:undefined},]];ErrorController=function(){function n(n){var i=this,t;this.errorPageExited=!1;t=0;n.$on("$routeChangeSuccess",function(){t++>0&&(i.errorPageExited=!0)})}return n}();ErrorController.$inject=["$scope"];RestartController=function(){function n(n,t,i,r){this.$location=n;this.$http=t;this.LibraryService=i;this.$q=r;this.id=n.search().id}return n.prototype.restart=function(){var n=this;console.log("restart clicked",this.id);this.$http.post("/api/notebooks/restart?id="+this.id,"").then(function(t){n.LibraryService.connectToServer(t.data,"")})},n}();RestartController.$inject=["$location","$http","LibraryService","$q"];angular.module("notebooks.index",["ngRoute","notebooks.libraries"]).config(["$routeProvider",function(n){n.when("/",{templateUrl:"/content/app/index/index.html",controller:IndexController,controllerAs:"index"});n.when("/notebooks/restart",{templateUrl:"/content/app/index/restart.html",controller:RestartController,controllerAs:"$ctrl"});n.when("/notebooks/unknown",{templateUrl:"/content/app/index/unknown.html"});n.when("/notebooks/accessDenied",{templateUrl:"/content/app/index/access_denied.html"})}]).directive("slick",function(){return{restrict:"A",link:function(n,t){var i=$(t[0]);i.slick({slidesToShow:3,infinite:!1,responsive:[{breakpoint:1200,settings:{slidesToShow:3}},{breakpoint:768,settings:{slidesToShow:1}},]});i.on("afterChange",function(n,t,i){$(".content").hide();$(".up-arrow").hide();$(".content[data-id="+i+"]").show();$(".up-arrow[data-id="+i+"]").show()})}}}).directive("profession",function(){return{restrict:"A",link:function(n,t){$(t[0]).on("click",function(){$(".up-arrow").hide();$(".content").hide();var n=$(this).attr("data-slick-index");n=="0"?($(".content[data-id=0]").show(),$(".up-arrow[data-id=0]").show()):n=="1"?($(".content[data-id=1]").show(),$(".up-arrow[data-id=1]").show()):($(".content[data-id=2]").show(),$(".up-arrow[data-id=2]").show())})}}}).directive("typed",function(){return{restrict:"A",link:function(n,t){var i=$(t[0]);i.typed({strings:["Python","R^750","F#^750","your browser"],typeSpeed:200,callback:function(){$(".typed-cursor").css({color:"white"})}})}}}).controller("IndexController",IndexController).controller("RestartController",RestartController).controller("ErrorController",ErrorController);angular.module("notebooks.import",["ngRoute"]).config(["$routeProvider",function(n){n.when("/import/gh/:user/:repo/",{templateUrl:"/content/app/import/importRedirect.html",controller:ImportController,controllerAs:"$ctrl",reloadOnSearch:!1,resolve:{importFrom:["$route",function(n){return"https://github.com/"+n.current.params.user+"/"+n.current.params.repo}],importStartUrl:["$route",function(n){return"/import/gh/"+n.current.params.user+"/"+n.current.params.repo+"/start"}]}});n.when("/import/gh/:user/:repo/start",{templateUrl:"/content/app/user/userLibraries.html",controller:UserLibrariesController,controllerAs:"$ctrl",reloadOnSearch:!1,resolve:{user:["UserService","$route",function(n){return n.curUserOrError().then(function(){return n.get(n.user.id).then(function(n){return n},function(){return{id:undefined}})})}],gitUrl:["$route",function(n){return"https://github.com/"+n.current.params.user+"/"+n.current.params.repo}],libraries:["UserService","$route",function(n){return n.curUserOrError().then(function(){var t=n.getLibrariesCached(n.user.id);return t?t:n.getLibraries(n.user.id).then(function(n){return n},function(){return undefined})})}],isHome:["UserService","$route",function(n){return n.curUserOrError()}]}})}]);ImportController=function(){function n(n,t,i,r,u,f,e,o,s,h){var c=this,l;this.UserService=n;this.$scope=t;this.$uibModal=i;this.LogService=r;this.$location=u;this.importFrom=f;this.importStartUrl=e;this.DialogService=o;this.$window=s;this.$interval=h;l=this;n.checkSignedIn().then(function(n){c.isSignedIn=n});this.LogService.metric("ImportFrom-LandingPage",1,{importFrom:this.importFrom,signedIn:this.isSignedIn})}return n.prototype.startImport=function(){this.LogService.metric("ImportFrom-StartImport",1,{importFrom:this.importFrom,signedIn:this.isSignedIn});this.$window.location.href=this.importStartUrl},n.prototype.returnToImportSource=function(){this.LogService.metric("ImportFrom-ReturnToSourcePage",1,{importFrom:this.importFrom,signedIn:this.isSignedIn});this.$window.location.href=this.importFrom},n}();ImportController.$inject=["UserService","$scope","$uibModal","LogService","$location","importFrom","importStartUrl","DialogService","$window","$interval"];angular.module("notebooks.import").controller("ImportController",ImportController);FAQController=function(){function n(n,t){this.LibraryService=n;this.site=t.protocol()+"://"+t.host()}return n.prototype.openNotebook=function(n,t,i){this.LibraryService.navigateToHtml({id:n,owner:t},i)},n}();FAQController.$inject=["LibraryService","$location"];angular.module("notebooks.faq",["ngRoute"]).config(["$routeProvider",function(n){n.when("/faq",{templateUrl:"/content/app/faq/faq.html",controller:FAQController,controllerAs:"$ctrl"})}]).controller("FAQController",FAQController).directive("faqSection",function(){return{restrict:"E",templateUrl:"/content/app/faq/faq_section.html",scope:{description:"@"},transclude:!0}}).directive("question",function(){return{restrict:"E",templateUrl:"/content/app/faq/question.html",scope:{title:"@",link:"@"},transclude:!0,controller:["$scope","$location",function(n,t){n.showAnswer=function(){return n.visible||n.$parent.expandAll||t.hash()==n.link};n.toggleAnswer=function(){n.visible=!n.visible;n.visible&&t.hash()==n.link&&t.hash("")}}]}}).directive("answer",function(){return{restrict:"E",templateUrl:"/content/app/faq/answer.html",transclude:!0}});UserService=function(){function n(n,t,i,r){this.$window=n;this.$http=t;this.$q=i;this.$location=r;this.user={signedIn:!1,email:undefined}}return n.prototype.signin=function(n){var t;t=n?n:this.$location.url()=="/"?"/home?signin=true":this.$location.url();this.$window.location.replace("/account/signin?redirect="+encodeURIComponent(t))},n.prototype.signout=function(){this.$window.location.replace("/account/signout")},n.prototype.save=function(n){var t=this;return this.$http.put("/api/user",n).then(function(){t.user=angular.copy(n)})},n.prototype.savePhoto=function(n,t){return this.$http.put("/api/user/"+n.id+"/photo",t)},n.prototype.isOwner=function(n){return n.id==this.user.id||n.id=="home"},n.prototype.getLibrariesCached=function(n){if(n==this.cachedFor)return this.cachedLibraries},n.prototype.getLibraries=function(n,t){var u=this,r,i;return t=t||{},r="/api/user/"+n+"/libraries",i=[],t.checkRunning&&i.push("checkRunning=true"),t.includeDescription&&i.push("includeDescription=true"),t.orderBy&&i.push("orderBy="+t.orderBy),t.top&&i.push("top="+String(t.top)),i.length&&(r+="?"+i.join("&")),this.$http.get(r).then(function(t){return u.cachedFor=n,u.cachedLibraries=angular.copy(t.data),t.data})},n.prototype.getClones=function(n,t,i){var r="/api/user/"+n+"/library/"+t+"/clones?max=100";return i&&(r+="&next="+i),this.$http.get(r).then(function(n){return n.data})},n.prototype.getCards=function(n){return this.$http.get("/api/user/"+n+"/cards").then(function(n){return n.data})},n.prototype.newLibrary=function(n,t){return this.$http.post("/api/user/"+n+"/library",t).then(function(n){return n.data},function(n){return n.status==409?{error:"A library with this ID already exists"}:{error:n.statusText}})},n.prototype.get=function(n){var t=this;return n.toLowerCase()=="home"?this.checkSignedIn().then(function(){if(!t.user.id){var n=angular.copy(t.user);return n.id="home",n}return t.user}):this.$http.get("/api/user/"+n).then(function(n){return n.data})},n.prototype.checkUserId=function(n){return this.$http.get("/api/user/id/"+n).then(function(){return null},function(n){return n.statusText})},n.prototype.getServiceConfig=function(){return this.config||(this.config=this.$http.get("/api/serviceconfigs")),this.config.then(function(n){return n.data})},n.prototype.checkSignedIn=function(){var n=this,t=this.$q.defer();return this.$http.get("/api/user").then(function(i){var r=i.data;n.user=r;t.resolve(n.user.signedIn)}),t.promise},n.prototype.curUserOrError=function(){var n=this,t=this.$q.defer();return this.$http.get("/api/user").then(function(i){var u=i.data,r;n.user=u;n.user.signedIn?t.resolve(n.user):(r=new RedirectOnResolve("/account/signin?redirect="+encodeURIComponent(n.$window.location.pathname)),t.reject(r))}),t.promise},n.prototype.library=function(n,t){return this.$http.get("/api/user/"+n+"/library/"+t+"?includeMetadata=true").then(function(n){return n.data})},n.prototype.libraryStatus=function(n,t){return this.$http.get("/api/user/"+n+"/library/"+t+"/status").then(function(n){return n.data})},n.prototype.libraryDirectory=function(n,t,i){var r="/api/user/"+n+"/library/"+t+"?includeMetadata=true&onlyFilesUnderDirectory="+i;return this.$http.get(r).then(function(n){return n.data})},n}();UserService.$inject=["$window","$http","$q","$location"];angular.module("notebooks.user",["ngRoute","notebooks.utils","ui.bootstrap.contextMenu"]).service("UserService",UserService).filter("clones",function(){return function(n){return n?n===1?"1 Clone":String(n)+" Clones":"0 Clones"}});EditFileController=function(){function n(n,t,i,r,u,f,e,o,s){var h=this,c,l;if(this.LibraryService=n,this.UserService=t,this.$location=i,this.library=r,this.file=u,this.contents=f,this.$timeout=e,this.$scope=o,this.$document=s,this.rename=function(){h.editingName=!1;h.$document.unbind("click",h.rename);h.LibraryService.renameFile(h.library,h.file,h.newFileName).then(function(){h.file=h.newFileName},function(n){h.errorText=n.data})},this.file=u,this.newFileName=u,this.library=r,c=this.file.lastIndexOf("."),this.mode="text",this.codemirrorOptions={lineWrapping:!0,lineNumbers:!0},c!=-1){l=this.file.substr(c+1);switch(l.toLowerCase()){case"html":case"htm":this.mode="html";break;case"r":this.codemirrorOptions.mode="r";break;case"py":this.codemirrorOptions.mode="python";break;case"md":this.codemirrorOptions.mode="markdown"}}}return n.prototype.beginRename=function(){var n=this;this.editingName=!0;this.$timeout(function(){n.$scope.$broadcast("renameFileFocus");n.$document.bind("click",n.rename)},10)},n.prototype.cancelRename=function(){this.editingName=!1;this.newFileName=this.file;this.$document.unbind("click",this.rename)},n.prototype.save=function(n){var t=this;n===void 0&&(n=!1);this.editingName=!1;this.LibraryService.updateFile(this.library,this.file,this.contents,this.newFileName).then(function(){t.file=t.newFileName;n||t.$location.url(t.library.owner+"/libraries/"+t.library.id)},function(n){t.errorText=n.data})},n}();EditFileController.$inject=["LibraryService","UserService","$location","library","file","contents","$timeout","$scope","$document"];angular.module("notebooks.libraries").controller("EditFileController",EditFileController);UserSettingsController=function(){function n(n,t,i,r){var u=this;this.signedIn=n;this.UserService=t;this.$scope=i;this.$location=r;this.contextHelpLink="/help/profiles";n||t.signin();this.photoSrc="/api/user/"+(t.user.id||"home")+"/photo";this.reset();this.newPhoto=function(n){var t=n.target.files,i;t&&t[0]&&(u.photo=t[0],i=new FileReader,i.onload=function(n){u.photoSrc=n.target.result;u.$scope.$apply()},i.readAsDataURL(t[0]))}}return n.prototype.save=function(){var n=this,t=function(){n.user.id?n.$location.url("/"+n.user.id):n.$location.url("/home")};this.UserService.save(this.user).then(function(){n.photo?n.UserService.savePhoto(n.user,n.photo).then(t,function(t){n.error="Photo save failed: "+t.statusText}):t()},function(t){n.error=t.statusText})},n.prototype.reset=function(n){n&&(n.$setPristine(),n.$setUntouched());this.user=angular.copy(this.UserService.user);this.originalId=this.user.id;this.error=undefined;this.status=undefined},n}();UserSettingsController.$inject=["signedIn","UserService","$scope","$location"];angular.module("notebooks.user").controller("UserSettingsController",UserSettingsController).config(["$routeProvider",function(n){n.when("/account/settings",{templateUrl:"/content/app/user/settings.html",controller:UserSettingsController,controllerAs:"settings",resolve:{signedIn:["UserService",function(n){return n.curUserOrError()}]}})}]).config(["$routeProvider",function(n){n.when("/account/signin",{templateUrl:"/content/app/user/signin.html"})}]).config(["$routeProvider",function(n){n.when("/account/signout",{templateUrl:"/content/app/user/signout.html"})}]).directive("validateUserid",["UserService","$q",function(n,t){return{require:"ngModel",link:function(i,r,u,f){f.$asyncValidators.userid=function(i){var r=t.defer();return f.$isEmpty(i)?(r.reject("Invalid user ID specified: cannot be empty"),f.userMessage="Invalid user ID specified: cannot be empty",r.promise):(n.checkUserId(i).then(function(n){n?(r.reject(n),f.userMessage=n):r.resolve()}),r.promise)}}}}]);UserLibraryController=function(){function n(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){var g=this,nt,k,d,tt,b;this.$routeParams=n;this.library=t;this.$location=i;this.$window=r;this.LibraryService=u;this.$uibModal=f;this.$scope=e;this.UserService=o;this.LogService=s;this.user=h;this.isHome=c;this.DialogService=l;this.path=a;this.SearchProxyService=v;this.$interval=y;this.$timeout=p;this.$document=w;this.contextHelpLink="/help/libraries/library-view";this.pathParts=[];this.suppressRefresh=!1;this.allLibraryFilesLoaded=!1;this.rename=function(){var n=g,t=n.renameInProgressForFile;if(n.renameInProgressForFile=undefined,n.$document.unbind("click",n.rename),n.LogService.metric("Command.UserLibrary.RenameFile",1,{owner:n.library.owner,library:n.library.id,file:t.path,newName:n.newFileName}),n.newFileName===t.path){n.suppressRefresh=!1;return}n.LibraryService.renameFile(n.library,t.path,n.newFileName).then(function(){t.path=n.newFileName;t.name=n.newFileName.split("/").pop();n.suppressRefresh=!1;n.refresh()},function(t){n.errorText=t.data})};nt=this;this.collapsed=!0;o.checkSignedIn().then(function(){g.isOwner=o.isOwner(h)});this.buttons=this.makeButtons();this.filters=this.makeFilters();this.contextMenu=buttonsToContext(r,this.buttons);k=a.split("/");d="tree";for(tt in k)b=k[tt],b&&(d+="/"+b,this.pathParts.push({path:d,name:b}));t!==undefined&&(this.items=new PagedData(e,v.makeSearchProxy(SearchSerializers.Pagination("path")),this.filters.filter,{plural:"files",singular:"file"}),this.items.setItems(nt.library.files),this.shareUrl="https://"+i.host()+"/"+t.owner+"/"+t.id,n.clone&&this.clone(),this.hasReadme=t.descriptionSource!=null)}return n.prototype.getFileIcon=function(t){if(t.isDirectory)return"notebook-icon-folder";var i,r;return(i=t.name.lastIndexOf("."))!=-1&&(r=n.ExtensionToIcon[t.name.substr(i+1).toLowerCase()]),r||"notebook-icon-text"},n.prototype.getFileLink=function(n){return n.isDirectory?"/"+this.user.id+"/libraries/"+this.library.id+"/tree/"+encodeURIComponent(n.path):n.name.match(".ipynb$")&&this.isOwner?"/run/"+this.user.id+"/"+this.library.id+"?dest=/notebooks/"+encodeURIComponent(n.path):"/"+this.user.id+"/libraries/"+this.library.id+"/html/"+encodeURIComponent(n.path)},n.prototype.getFileTarget=function(n){return n.name.match(".ipynb$")?"_blank":"_self"},n.prototype.getActiveFiltersAsQueryString=function(){var i=this,t="",n,r;for(n in i.filters.values)n!=="path"&&(r=i.filters.filter.filters[n].serializer.serialize(i.filters.values[n]),r!==undefined)&&(t+=t.length?"&":"?",t+=n+"="+r);return t},n.prototype.makeButtons=function(){var t=this,n=this;return[{getDisabled:function(){return!n.isOwner},get title(){if(n.isOwner)"Run Library";else{if(n.items.getContextButtonsDisabled())return"Select a notebook to run it";if(!n.isSelectedIpynb(n.items.selected))return"Please select a notebook (.ipynb) to run"}return"Please clone this library to run"},type:"link",target:"_blank",getHref:function(t){return t&&n.isSelectedIpynb(t)?"/run/"+n.user.id+"/"+n.library.id+"?dest=/notebooks/"+encodeURIComponent(t.path):"/run/"+n.user.id+"/"+n.library.id},click:function(){return n.library.isRunning=!0},icon:"notebook-icon-run library-button-icon",text:"Run",contextual:!0,contextualAlwaysOn:!0,shortcut:"r"},{get hidden(){return!n.isOwner},title:"New",type:"action",click:function(){return n.add()},icon:"notebook-icon-add library-button-icon",text:"New",textPriority:"low",focusOn:"focusOnNewNotebook",shortcut:"n"},{get hidden(){return!n.isOwner},title:"Edit Library Settings",type:"action",click:function(){return n.edit()},icon:"glyphicon glyphicon-cog library-button-icon",text:"Settings",textPriority:"low",shortcut:"e"},{title:"Share Library",type:"action",click:function(){return n.share()},icon:"notebook-icon-share library-button-icon",text:"Share",focusOn:"focusOnShareLibrary",shortcut:"s"},{title:"Clone Library",type:"action",click:function(){return n.clone()},icon:"notebook-icon-create-clone library-button-icon",text:"Clone",focusOn:"focusOnShareLibrary",shortcut:"c"},{get hidden(){return n.library.hideClones&&!n.isOwner},title:"Clones",type:"link",getHref:function(){return"/"+(n.library.owner||"home")+"/libraries/"+n.library.id+"/clones"},icon:"notebook-icon-create-fork library-button-icon",get text(){return n.library.cloneCount!=1?n.library.cloneCount+" Clones":"1 Clone"},shortcut:"l"},{get hidden(){return!n.isOwner},title:"Open Terminal",type:"link",target:"_blank",getHref:function(){return"/run/"+n.user.id+"/"+n.library.id+"?dest=/terminals/1"},icon:"notebook-icon-terminal library-button-icon",text:"Terminal",textPriority:"low",shortcut:"t"},{getDisabled:function(){return!n.isOwner||!n.library.isRunning},get hidden(){return!n.isOwner},title:"Shutdown Server",type:"action",target:"_blank",click:function(){n.DialogService.shutdown(n.library)},icon:"glyphicon glyphicon-stop",text:"Shutdown",textPriority:"low",shortcut:"h"},{type:"separator"},{getDisabled:function(n){return n.isDirectory},title:"Preview or Print",type:"link",getHref:function(t){if(t)return"/"+n.user.id+"/libraries/"+n.library.id+"/html/"+encodeURIComponent(t.path)},icon:"notebook-icon-print library-button-icon",text:"Preview",contextual:!0,shortcut:"p"},{getDisabled:function(n){return n.isDirectory},get hidden(){return!n.isOwner},title:"Edit File",type:"link",getHref:function(t){return"/"+n.user.id+"/libraries/"+n.library.id+"/edit/"+encodeURIComponent(t.path)},icon:"notebook-icon-text library-button-icon",text:"Edit File",contextual:!0,shortcut:"i"},{getDisabled:function(n){return n.isDirectory},title:"Download File",type:"action",click:function(t){return n.downloadFile(t)},icon:"notebook-icon-download library-button-icon",text:"Download",textPriority:"low",contextual:!0,shortcut:"d"},{get hidden(){return!n.isOwner},title:"Rename File",type:"action",click:function(n){t.beginRename(n)},icon:"library-button-icon",text:"Rename",textPriority:"low",contextual:"menuOnly",shortcut:"a"},{get hidden(){return!n.isOwner},title:"Delete File",type:"action",click:function(t){return n.del(t)},icon:"notebook-icon-trash library-button-icon",text:"Delete",textPriority:"low",contextual:!0,shortcut:"x"},]},n.prototype.makeFilters=function(){var n=this;return new TableSearchItemFilters(this.SearchProxyService,{path:{serializer:SearchSerializers.UndefinedString,control:{kind:"search",get search(){return n.filters.values.path},set search(t){n.filters.values.path=t;t!=""?n.allLibraryFilesLoaded?n.items.setItems(n.allLibraryFiles):(n.filters.controls.path.inProgress=!0,n.UserService.library(n.user.id,n.library.id).then(function(t){n.allLibraryFilesLoaded=!0;n.allLibraryFiles=t.files;n.items.setItems(n.allLibraryFiles);n.filters.controls.path.inProgress=!1})):n.items.setItems(n.library.files)}},matchers:{path:function(t,i){return t.indexOf(n.path)!==0?!1:i===undefined?!0:t.toLowerCase().indexOf(i.toLowerCase())!=-1}}},showHidden:{serializer:SearchSerializers.FalseBoolean,control:{kind:"toggle",text:"Show hidden items",label:"Show hidden items",get active(){return n.filters.values.showHidden},click:function(){n.filters.values.showHidden=!n.filters.values.showHidden}},matchers:{path:function(t,i){if(i)return!0;var r=t.substr(n.path.length);return r.split("/").every(function(n){return n.charAt(0)!=="."})}}}})},n.prototype.getFileType=function(t){var i,r;return t.isDirectory?"Folder":(i=t.path.lastIndexOf("."),i==-1)?"File":(r=t.path.substr(i+1).toLowerCase(),n.fileTypes[r]||r.toUpperCase())},n.prototype.getDiffUrl=function(){var n=this.library.clonedFrom.owner+"/libraries/"+this.library.clonedFrom.id+"/diff?diffLib="+this.library.id;return this.library.owner!=this.library.clonedFrom.owner&&(n+="&diffUser="+this.library.owner),n},n.prototype.isSelectedIpynb=function(n){var t=n.path.match(/\.ipynb$/gi);return t!=null},n.prototype.sort=function(){this.items.setSortProperty(this.sortOrder)},n.prototype.openSimple=function(n,t,i,r){return this.$uibModal.open({animation:!0,templateUrl:n,controller:t,controllerAs:i,resolve:r})},n.prototype.downloadFile=function(n){this.LogService.metric("Command.UserLibrary.FileDownloaded",1,{owner:this.library.owner,library:this.library.id,file:n.path});this.LibraryService.downloadFile(this.library,n.path)},n.prototype.run=function(n){this.LogService.metric("Command.UserLibrary.Run",1,{owner:this.library.owner,library:this.library.id});this.LibraryService.runLibrary(this.library,n,!0)},n.prototype.clone=function(){this.LogService.metric("Command.UserLibrary.Clone",1,{owner:this.library.owner,library:this.library.id});this.LibraryService.cloneLibraryAndNavigate(this.library)},n.prototype.refresh=function(){var n=this;n.suppressRefresh||n.UserService.libraryDirectory(n.library.owner,n.library.id,n.path).then(function(t){var i,u,r;if(!n.suppressRefresh&&(i=n.items.selected,n.library=t,n.items.setItems(n.library.files),i!==undefined))for(u in n.items.displayed)if(r=n.items.displayed[u],i&&i.path===r.path){n.items.selectRow(r);break}})},n.prototype.del=function(n){var i=this,t,r;this.suppressRefresh=!0;this.LogService.metric("Command.UserLibrary.DeleteFile",1,{owner:this.library.owner,library:this.library.id,file:n.path});t=this;r=this.$uibModal.open({animation:!0,templateUrl:"/content/app/libraries/deleteNotebook.html",controller:"DeleteNotebookController",controllerAs:"del",resolve:{library:this.library,notebook:n,removeNotebook:function(){return function(n){var i=t.items.all.indexOf(n);i!==-1&&t.items.all.splice(i,1);i=t.library.files.indexOf(n);i!==-1&&t.library.files.splice(i,1)}}}});r.result.then(function(){i.$scope.$broadcast("focusOnDeleteNotebook");i.suppressRefresh=!1})},n.prototype.beginRename=function(n){var t=this;this.renameInProgressForFile=n;this.newFileName=n.path;this.suppressRefresh=!0;this.$timeout(function(){t.$scope.$broadcast("renameFileFocus");t.renameInProgressForFile=n;t.$document.bind("click",t.rename)},10)},n.prototype.cancelRename=function(){this.renameInProgressForFile=undefined;this.$document.unbind("click",this.rename);this.suppressRefresh=!1},n.prototype.createReadme=function(){var n=this;this.LibraryService.newFile(this.library,"README.md",undefined,!1).then(function(){n.$location.path("/"+n.library.owner+"/libraries/"+n.library.id+"/edit/README.md");n.$location.replace()})},n.prototype.add=function(){var n=this,t;this.LogService.metric("Command.UserLibrary.AddFile",1,{owner:this.library.owner,library:this.library.id});t=this.$uibModal.open({animation:!0,templateUrl:"/content/app/libraries/addFile.html",controller:AddFileController,controllerAs:"add",resolve:{library:this.library,pageController:this}});t.result.then(function(){n.$scope.$broadcast("focusOnNewNotebook");n.refresh()})},n.prototype.edit=function(){var n=this,t;this.LogService.metric("Command.UserLibrary.Edit",1,{owner:this.library.owner,library:this.library.id});t=this;this.UserService.library(t.user.id,this.library.id).then(function(i){n.library.files=i.files;t.suppressRefresh=!0;var r=angular.copy(n.library),u=n.DialogService.openSimple("/content/app/libraries/editLibrary.html","EditLibraryController","edit",{library:n.library,baseLibraryUrl:function(){return n.$location.protocol()+"://"+n.$location.host()+"/"+n.library.owner+"/libraries/"}},"lg");u.result.then(function(){if(t.suppressRefresh=!1,t.refresh(),r.id!=t.library.id){var i="/"+n.library.owner+"/libraries/"+n.library.id;n.pathParts.length&&(i+="/"+n.pathParts[n.pathParts.length-1].path);n.$location.path(i);n.$location.replace()}},function(){t.suppressRefresh=!1;t.refresh();angular.copy(r,n.library)})})},n.prototype.share=function(){var t=this,n;this.LogService.metric("Command.UserLibrary.Share",1,{owner:this.library.owner,library:this.library.id});n=this.DialogService.openShare(this.library);n.result.then(function(){t.$scope.$broadcast("focusOnShareLibrary")})},n}();UserLibraryController.$inject=["$routeParams","library","$location","$window","LibraryService","$uibModal","$scope","UserService","LogService","user","isHome","DialogService","path","SearchProxyService","$interval","$timeout","$document"];UserLibraryController.fileTypes={ipynb:"Notebook",py:"Python",r:"R",fs:"F#",js:"JavaScript",txt:"Text",md:"Markdown"};UserLibraryController.ExtensionToIcon={ipynb:"notebook-icon-notebook_outline",pdf:"notebook-icon-image",png:"notebook-icon-image",bmp:"notebook-icon-image",gif:"notebook-icon-image",jpg:"notebook-icon-image",jpeg:"notebook-icon-image"};angular.module("notebooks.libraries").controller("UserLibraryController",UserLibraryController);UserLibrariesController=function(){function n(n,t,i,r,u,f,e,o,s,h,c,l,a,v){var y=this,p;this.user=n;this.UserService=t;this.$scope=i;this.LibraryService=r;this.$uibModal=u;this.LogService=f;this.$location=e;this.isHome=o;this.gitUrl=s;this.DialogService=h;this.$window=c;this.SearchProxyService=a;this.$interval=v;this.contextHelpLink="/help/libraries";p=this;this.buttons=this.makeButtons();this.filters=this.makeFilters();this.contextMenu=buttonsToContext(c,this.buttons);this.suppressLibraryRefresh=!1;this.isOwner=t.isOwner(n);t.checkSignedIn().then(function(){if(y.isOwner=t.isOwner(n),y.isOwner){y.refreshLibraries();var r=p.$interval(function(){p.refreshLibraries()},6e4);i.$on("$destroy",function(){v.cancel(r)})}});this.items=new PagedData(i,a.makeSearchProxy(SearchSerializers.Pagination("name")),this.filters.filter,{plural:"libraries",singular:"library"});n.id&&this.setLibraries(l);this.gitUrl&&(this.LogService.metric("Import From: Passed Signin.",1,{importFrom:this.gitUrl,signedIn:!0}),this.add(this.gitUrl))}return n.prototype.makeButtons=function(){var n=this;return[{get hidden(){return!n.isOwner},title:"New Library",type:"action",click:function(){n.add()},icon:"notebook-icon-add library-button-icon",text:"New Library",focusOn:"focusOnNewLibrary",shortcut:"n"},{title:"Share Library",type:"action",click:function(t){n.share(t)},icon:"notebook-icon-share library-button-icon",text:"Share",focusOn:"focusOnShareLibrary",contextual:!0,shortcut:"s"},{type:"separator"},{title:"Clone Library",type:"action",click:function(t){n.clone(t)},icon:"notebook-icon-create-clone library-button-icon",text:"Clone",contextual:!0,shortcut:"c"},{getDisabled:function(){return!n.isOwner},get title(){if(n.isOwner)"Run Library";else if(n.items.getContextButtonsDisabled())return"Select a library to run it";return"Please clone this library to run"},type:"link",getHref:function(t){if(t)return"/run/"+n.user.id+"/"+t.id},target:"_blank",click:function(n){return n.isRunning=!0},icon:"notebook-icon-run library-button-icon",text:"Run",contextual:!0,shortcut:"r"},{get hidden(){return!n.isOwner},title:"Run in JupyterLab",type:"link",getHref:function(t){if(t)return"/run/"+n.user.id+"/"+t.id+"?dest=/lab"},target:"_blank",icon:"notebook-icon-run library-button-icon",text:"Run in JupyterLab",contextual:"menuOnly",shortcut:"a"},{get hidden(){return!n.isOwner},title:"Edit Library Settings",type:"action",click:function(t){n.edit(t)},icon:"glyphicon glyphicon-cog library-button-icon",text:"Settings",focusOn:"focusOnEditLibrary",contextual:!0,shortcut:"e"},{get hidden(){return!n.isOwner},title:"Open Terminal",type:"link",target:"_blank",getHref:function(t){return"/run/"+n.user.id+"/"+t.id+"?dest=/terminals/1"},icon:"notebook-icon-terminal library-button-icon",text:"Terminal",textPriority:"low",shortcut:"t",contextual:!0},{getDisabled:function(t){return!n.isOwner||!t.isRunning},get hidden(){return!n.isOwner},title:"Shutdown Server",type:"action",target:"_blank",click:function(t){n.DialogService.shutdown(t)},icon:"glyphicon glyphicon-stop",text:"Shutdown",textPriority:"low",shortcut:"h",contextual:!0},{title:"Download Library",type:"action",click:function(t){n.download(t)},icon:"notebook-icon-download library-button-icon",text:"Download",contextual:!0,shortcut:"d"},{get hidden(){return!n.isOwner},title:"Delete Library",type:"action",click:function(t){n.delete(t)},icon:"notebook-icon-trash library-button-icon",text:"Delete",contextual:!0,shortcut:"x"},]},n.prototype.makeFilters=function(){var t=this;return new TableSearchItemFilters(this.SearchProxyService,{name:{serializer:SearchSerializers.UndefinedString,control:{kind:"search",get search(){return t.filters.values.name},set search(n){t.filters.values.name=n}},matchers:{name:Filters.MatchString}},visibility:{serializer:n.PublicPrivateSerializer,control:{kind:"dropdown",get text(){switch(t.filters.values.visibility){case!0:return"Show Public Only";case!1:return"Show Private Only";case undefined:return"Show Public And Private"}},items:[{label:"Show Public And Private",click:function(){return t.filters.values.visibility=undefined}},{label:"Show Public Only",click:function(){return t.filters.values.visibility=!0}},{label:"Show Private Only",click:function(){return t.filters.values.visibility=!1}}]},matchers:{"public":function(n,t){return t===!0?n===null||n===!0:t===!1?n===!1:!0}}}})},n.prototype.setLibraries=function(n){var i,f,t,r,u;if(!this.suppressLibraryRefresh&&(i=this.items.selected,this.items.setItems(n),i&&this.items.selected))for(f=!1,t=0,r=n;t<r.length;t++)if(u=r[t],u.id==i.id){f=!0;this.items.selected=u;break}},n.prototype.baseUrl=function(){var n=this.$location.absUrl();return n.toString().substring(0,n.length-this.$location.path().length+1)},n.prototype.add=function(n){var t=this,i;n===void 0&&(n=undefined);this.LogService.metric("Command.UserLibraries.Add",1);i=this.DialogService.openSimple("/content/app/libraries/new.html",NewLibraryController,"newLibrary",{dashboard:this,baseLibraryUrl:function(){return t.baseUrl()+t.user.id+"/libraries/"},userId:function(){return t.UserService.user.id},gitRepository:function(){return n}},"lg");i.result.then(function(n){t.$location.url("/"+n.owner+"/libraries/"+n.id);t.$scope.$broadcast("focusOnNewLibrary")})},n.prototype.download=function(n){this.LogService.metric("Command.UserLibraries.DownloadLibrary",1,{library:n.id});this.LibraryService.downloadLibrary(n)},n.prototype.runLibrary=function(n){this.LogService.metric("Command.UserLibraries.Run",1,{library:n.id});this.LibraryService.runLibrary(n,null,!0)},n.prototype.cloneAndRun=function(n){this.LogService.metric("Command.UserLibraries.Run",1,{library:n.id});this.LibraryService.cloneAndRun(n)},n.prototype.clone=function(n){var t=this;this.UserService.checkSignedIn().then(function(){t.LogService.metric("Command.UserLibraries.Clone",1,{library:n.id});t.LibraryService.cloneLibraryAndNavigate(n)})},n.prototype.share=function(n){var i=this,t;this.LogService.metric("Command.UserLibraries.Share",1,{library:n.id});t=this.DialogService.openShare(n);t.result.then(function(){i.$scope.$broadcast("focusOnShareLibrary")})},n.prototype.edit=function(n){var t=this,i;return this.LogService.metric("Command.UserLibraries.Edit",1,{library:n.id}),i=this,this.UserService.library(i.user.id,n.id).then(function(i){var r,u;n.setupSteps=i.setupSteps;n.files=i.files;r=angular.copy(n);t.suppressLibraryRefresh=!0;u=t.DialogService.openSimple("/content/app/libraries/editLibrary.html","EditLibraryController","edit",{library:n,baseLibraryUrl:function(){return t.$location.protocol()+"://"+t.$location.host()+"/"+t.user.id+"/libraries/"}},"lg");u.result.then(function(){t.suppressLibraryRefresh=!1;t.refreshLibraries();t.$scope.$broadcast("focusOnEditLibrary")},function(){angular.copy(r,n);t.suppressLibraryRefresh=!1;t.refreshLibraries();t.$scope.$broadcast("focusOnEditLibrary")})},function(){return undefined})},n.prototype.refreshLibraries=function(){var n=this;this.UserService.getLibraries(this.user.id,{checkRunning:this.isOwner}).then(function(t){n.setLibraries(t)})},n.prototype.delete=function(n){var i=this,t;this.LogService.metric("Command.UserLibraries.DeleteLibrary",1,{library:n.id});t=this.DialogService.openSimple("/content/app/libraries/deleteLibrary.html","DeleteLibraryController","del",{library:n,dashboard:this},"md");t.result.then(function(){i.$scope.$broadcast("focusOnDeleteLibrary")})},n.prototype.remove=function(n){for(var i=-1,t=0;t<this.items.all.length;t++)if(this.items.all[t].id==n.id){i=t;break}i!=-1&&this.items.all.splice(i,1)},n}();UserLibrariesController.$inject=["user","UserService","$scope","LibraryService","$uibModal","LogService","$location","isHome","gitUrl","DialogService","$window","libraries","SearchProxyService","$interval"];UserLibrariesController.PublicPrivateSerializer=SearchSerializer(function(n){return n==="public"?!0:n==="private"?!1:undefined},function(n){return n===!0?"public":n===!1?"private":void 0});angular.module("notebooks.user").controller("UserLibrariesController",UserLibrariesController);ClonesListController=function(){function n(n,t,i,r,u,f,e,o,s,h){this.library=n;this.$location=t;this.LibraryService=i;this.$scope=r;this.UserService=u;this.LogService=f;this.user=e;this.DialogService=o;this.$window=s;this.SearchProxyService=h;this.contextHelpLink="/help/libraries/clones/clones-list";this.collapsed=!0;this.buttons=this.makeButtons();this.filters=this.makeFilters();this.contextMenu=buttonsToContext(s,this.buttons);this.items=new PagedData(r,h.makeSearchProxy(SearchSerializers.Pagination("path")),this.filters.filter,{plural:"clones",singular:"clone"});this.loadingMore=!1;this.loadClones()}return n.prototype.makeButtons=function(){var n=this;return[{title:"View Differences",type:"link",getHref:function(t){if(t)return n.getDiffUrl(t)},icon:"notebook-icon-diff  library-button-icon",text:"Compare Clone",contextual:!0,shortcut:"c"},{title:"Clone Library",type:"action",click:function(t){return n.clone(t)},icon:"notebook-icon-create-clone  library-button-icon",text:"Clone",contextual:!0,shortcut:"l"},{title:"Share Library",type:"action",click:function(t){return n.share(t)},icon:"notebook-icon-share library-button-icon",text:"Share",focusOn:"focusOnShareLibrary",contextual:!0,shortcut:"s"},{title:"Download Clone",type:"action",click:function(t){return n.download(t)},icon:"notebook-icon-download library-button-icon",text:"Download Clone",contextual:!0,shortcut:"d"}]},n.prototype.makeFilters=function(){var n=this;return new TableSearchItemFilters(this.SearchProxyService,{owner:{serializer:SearchSerializers.UndefinedString,control:{kind:"search",get search(){return n.filters.values.owner},set search(t){n.filters.values.owner=t}},matchers:{owner:Filters.MatchString}}})},n.prototype.getDiffUrl=function(n){var t="/"+this.library.owner+"/libraries/"+this.library.id+"/diff?diffLib="+n.id;return this.library.owner!=n.owner&&(t+="&diffUser="+n.owner),t},n.prototype.loadClones=function(n){var t=this;this.UserService.getClones(this.library.owner,this.library.id,n).then(function(i){i.libraries.forEach(function(n){n.ownerId=n.owner+"/"+n.id});t.loaded=!0;n?t.items.all=t.items.all.concat(i.libraries):t.items.setItems(i.libraries);i.next?(t.loadingMore=!0,t.loadClones(i.next)):t.loadingMore=!1})},n.prototype.sort=function(){this.items.setSortProperty(this.sortOrder)},n.prototype.clone=function(n){var t=this;this.UserService.checkSignedIn().then(function(){t.LogService.metric("Command.Clones.Clone",1,{library:n.id});t.LibraryService.cloneLibraryAndNavigate(n)})},n.prototype.share=function(n){var i=this,t;this.LogService.metric("Command.Clones.Share",1,{library:n.id,owner:n.owner});t=this.DialogService.openShare(n);t.result.then(function(){i.$scope.$broadcast("focusOnShareLibrary")})},n.prototype.download=function(n){this.LogService.metric("Command.Clones.LibraryDownloaded",1,{library:n.id,owner:n.owner});this.LibraryService.downloadLibrary(n)},n.prototype.refresh=function(){this.LogService.metric("Command.Clones.Refreshed",1,{library:this.library.id,owner:this.library.owner});this.loadClones()},n}();ClonesListController.$inject=["library","$location","LibraryService","$scope","UserService","LogService","user","DialogService","$window","SearchProxyService"];angular.module("notebooks.libraries").controller("ClonesListController",ClonesListController);UserIdController=function(){function n(n,t,i,r,u){this.$uibModalInstance=n;this.reason=t;this.user=i;this.UserService=r;this.$location=u;this.user=angular.copy(i);this.initialId=this.user.id;this.baseUrl=this.$location.protocol()+"://"+this.$location.host()}return n.prototype.close=function(){this.$uibModalInstance.close()},n.prototype.save=function(){var n=this;this.UserService.save(this.user).then(function(){return n.$uibModalInstance.close()})},n}();UserIdController.$inject=["$uibModalInstance","reason","user","UserService","$location"];angular.module("notebooks.user").controller("UserIdController",UserIdController);RestartLibraryController=function(){function n(n,t,i,r){this.library=n;this.$http=t;this.status=i;this.LibraryService=r}return n.prototype.restart=function(){var n=this;this.status.id===undefined?this.LibraryService.runLibrary(this.library):this.$http.post("/api/notebooks/restart?id="+this.status.id,"").then(function(t){n.LibraryService.connectToServer(t.data,"",n.library)})},n}();RestartLibraryController.$inject=["library","$http","status","LibraryService"];LibraryDiffController=function(){function n(n,t,i,r){var f=this;if(this.library=n,this.diff=t,this.LibraryService=i,this.$q=r,this.contextHelpLink="/help/libraries/comparing",n!==undefined&&t!==undefined){for(var u=[],e=0,o=0,s=r.when(),c=function(){var r=n.files[e],l=t.files[o],a,v,y,p,c;if(r&&r.isDirectory)return e++,"continue";if(l&&l.isDirectory)return o++,"continue";a=void 0;r===undefined?a=-1:l===undefined?a=1:r.path.toLowerCase()==l.path.toLowerCase()?a=0:r.path.toLowerCase()<l.path.toLowerCase()?a=1:r.path.toLowerCase()>l.path.toLowerCase()&&(a=-1);switch(a){case 0:getExtension(r.path).toLowerCase()=="ipynb"?(c={type:"notebook",name:r.path,show:!0,state:"both",loadDiff:function(){var u={};return s=s.then(function(){return f.$q.all([i.diffFile(n,t,r.path).then(function(n){return u.changes=n}),i.getNotebook(n,r.path).then(function(n){return u.left=n})]).then(function(){return u.right={},u})})}},u.push(c)):(v=h.getFileType(r.path),v&&(c={type:v,name:r.path,show:!0,state:"both",loadDiff:function(){var u={extension:getExtension(r.path)};return s=s.then(function(){return f.$q.all([i.getFile(n,r.path,v=="image").then(function(n){return u.left=n}),i.getFile(t,l.path,v=="image").then(function(n){return u.right=n})]).then(function(){return u})})}},u.push(c)));e++;o++;break;case-1:o++;getExtension(l.path).toLowerCase()=="ipynb"?(c={type:"notebook",name:l.path,show:!1,state:"right",loadDiff:function(){return f.LibraryService.getNotebook(t,l.path).then(function(n){return{right:n}})}},u.push(c)):(y=h.getFileType(l.path),y&&(c={type:y,name:l.path,show:!1,state:"right",loadDiff:function(){return f.LibraryService.getFile(t,l.path,y=="image").then(function(n){return{extension:getExtension(l.path),right:n}})}},u.push(c)));break;case 1:e++;getExtension(r.path).toLowerCase()=="ipynb"?(c={type:"notebook",name:r.path,show:!1,state:"left",loadDiff:function(){return i.getNotebook(n,r.path).then(function(n){return{left:n}})}},u.push(c)):(p=h.getFileType(r.path),p&&(c={type:p,name:r.path,show:!1,state:"left",loadDiff:function(){return f.LibraryService.getFile(n,r.path,p=="image").then(function(n){return{extension:getExtension(r.path),left:n}})}},u.push(c)))}},h=this;e<n.files.length||o<t.files.length;)c();this.files=u}}return n.prototype.getFileType=function(n){var t=getExtension(n).toLowerCase();switch(t){case"ipynb":return"notebook";case"gif":case"jpeg":case"png":return"image";case"txt":case"md":case"html":case"htm":case"py":case"r":case"fs":case"sh":return"text"}return null},n}();LibraryDiffController.$inject=["library","diff","LibraryService","$q"];angular.module("notebooks.diff",["notebooks.utils","ui.codemirror"]).controller("LibraryDiffController",LibraryDiffController);NotebookCellController=function(){function n(){this.toolbar=!1}return n.prototype.getImageOverlayClass=function(n){switch(n.change){case"add":return"diff-image-added-overlay";case"remove":return"diff-image-removed-overlay"}},n.prototype.getOutputText=function(n){return typeof n=="string"?n:n.join("")},n.prototype.getErrorText=function(n){return typeof n=="string"?n:n.join("\n")},n.prototype.removeEscapes=function(n){for(var t;;){if(t=n.replace(/\x1b\[[0-9;]*m/,""),t==n)break;n=t}return n},n.prototype.getChangesFromMetadata=function(n,t){var i=undefined,u,r;if(n.metadata!==undefined&&(n.metadata.nbChangeKind=="add"||n.metadata.nbChangeKind=="remove"))for(u=t.split("\n").length,i=[],r=0;r<u;r++)i.push(n.metadata.nbChangeKind=="add"?"diff-add":"diff-remove");return i},n.prototype.initInput=function(){this.input=typeof this.cell.source=="string"?this.cell.source:this.cell.source.join("")},n.prototype.initOutputs=function(){var r,o,t,i,u,s,f,h,e,c;if(this.outputs=[],this.showOut=!1,this.cell.outputs!==undefined&&this.cell.outputs.length)for(r=0,o=this.cell.outputs;r<o.length;r++){t=o[r];switch(t.output_type){case"stream":i=this.getOutputText(t.text);u=this.getChangesFromMetadata(t,i);this.outputs.push({kind:"text",value:this.getOutputText(t.text),classes:u});break;case"display_data":case"execute_result":for(s=!1,f=0,h=n.outputProcessors;f<h.length;f++)if(e=h[f],t.data[e.kind]!==undefined){c=e.processor(t.data[e.kind],t.metadata);this.outputs.push(c);s=!0;break}s||this.outputs.push({kind:"unsupported"});t.output_type=="execute_result"&&(this.showOut=!0,this.outPreviousExecutionCount=t.previous_execution_count,this.outExecutionCount=t.execution_count);break;case"error":i=this.removeEscapes(this.getErrorText(t.traceback));u=this.getChangesFromMetadata(t,i);this.outputs.push({kind:"text",value:i,classes:u})}}},n.prototype.initToolbar=function(){this.cell.metadata!==undefined&&(this.cell.metadata.nbMetadataChanged||this.cell.metadata.tags||this.cell.metadata.nbTagsRemoved)&&(this.toolbar=!0)},n.prototype.$onInit=function(){var n=this;this.initInput();this.initOutputs();this.initToolbar();this.cell.cell_type=="markdown"&&(this.language="markdown");this.codemirrorOptions={lineWrapping:!1,lineNumbers:!1,mode:this.language,readOnly:!0,onLoad:function(t){if(n.cell.metadata.nbLineClasses)t.on("renderLine",function(i,r,u){var e=t.lineInfo(r),f=n.cell.metadata.nbLineClasses[e.line];f&&(u.className+=" "+f)});t.on("change",function(){var i,u,r;if(n.cell.metadata.nbDiffRanges)for(i=0,u=n.cell.metadata.nbDiffRanges;i<u.length;i++)r=u[i],t.markText(r.start,r.stop,{className:r.kind})})}}},n.prototype.getOutputOptions=function(n){return{lineWrapping:!1,lineNumbers:!1,readOnly:!0,onLoad:function(t){if(n.classes)t.on("renderLine",function(i,r,u){var e=t.lineInfo(r),f=n.classes[e.line];f&&(u.className+=" "+f)});if(n.ranges)t.on("change",function(){for(var r,i=0,u=n.ranges;i<u.length;i++)r=u[i],t.markText(r.start,r.stop,{className:r.kind})})}}},n.makeProcessors=function(){return[{kind:"application/nbdiff",processor:function(n){return{kind:"text",value:n.lines.join(""),classes:n.classes,ranges:n.ranges}}},{kind:"image/png",processor:function(n,t){return{kind:"image",source:"data:image/png;base64,"+n,change:t.nbChangeKind}}},{kind:"image/jpeg",processor:function(n,t){return{kind:"image",source:"data:image/jpeg;base64,"+n,change:t.nbChangeKind}}},{kind:"image/gif",processor:function(n,t){return{kind:"image",source:"data:image/gif;base64,"+n,change:t.nbChangeKind}}},{kind:"image/jpg",processor:function(n,t){return{kind:"image",source:"data:image/jpg;base64,"+n,change:t.nbChangeKind}}},{kind:"text/plain",processor:function(n){return typeof n!="string"&&(n=n.join("\n")),{kind:"text",value:n}}},]},n}();NotebookCellController.$inject=[];NotebookCellController.outputProcessors=NotebookCellController.makeProcessors();angular.module("notebooks.diff").component("notebookCell",{templateUrl:"/content/app/diff/notebookCell.html",controller:NotebookCellController,bindings:{cell:"<",language:"<"}});LazyDiffController=function(){function n(){}return n.prototype.$onInit=function(){var n=this;this.loadDiff().then(function(t){return n.diff=t})},n}();LazyDiffController.$inject=[];angular.module("notebooks.diff").component("lazyDiff",{templateUrl:"/content/app/diff/lazyDiff.html",controller:LazyDiffController,bindings:{loadDiff:"<",diffType:"<"}});FileDiffController=function(){function n(){}return n}();FileDiffController.$inject=[];angular.module("notebooks.diff").component("fileDiff",{templateUrl:"/content/app/diff/fileDiff.html",controller:FileDiffController,bindings:{diff:"<",type:"<"}});ImageDiffController=function(){function n(){}return n.prototype.$onChanges=function(){this.diff.left&&this.diff.right?this.diff.left!=this.diff.right?(this.left="data:image/"+this.diff.extension+";base64,"+this.diff.left,this.right="data:image/"+this.diff.extension+";base64,"+this.diff.right):this.both="data:image/"+this.diff.extension+";base64,"+this.diff.left:this.diff.left?this.left="data:image/"+this.diff.extension+";base64,"+this.diff.left:this.diff.right&&(this.right="data:image/"+this.diff.extension+";base64,"+this.diff.right)},n}();ImageDiffController.$inject=[];angular.module("notebooks.diff").component("imageDiff",{templateUrl:"/content/app/diff/imageDiff.html",controller:ImageDiffController,bindings:{diff:"<"}});IpynbDiffController=function(){function n(){}return n.prototype.getLanguage=function(){var n;return this.diff.left&&this.diff.left.metadata&&this.diff.left.metadata.kernelspec&&(n=this.diff.left.metadata.kernelspec.language),!n&&this.diff.right&&this.diff.right.metadata&&this.diff.right.metadata.kernelspec&&(n=this.diff.right.metadata.kernelspec.language),n||(n="python"),n},n.prototype.expandCells=function(n){for(var t=n;t<this.impactedCells.length;t++){if(!this.impactedCells[t].metadata.collapsed)break;this.impactedCells[t].metadata.collapsed=!1}},n.prototype.$onChanges=function(){(this.impactedCells=[],this.diff!==undefined)&&(this.diff.left?this.diff.right?this.diff.changes.length!=0?this.addChanges():this.addLeftCells(!0):this.addLeftCells(!1,"diff-remove"):this.addRightCells())},n.prototype.addChanges=function(){for(var r=this.diff.changes,n,t=0,i=r;t<i.length;t++){n=i[t];switch(n.op){case"patch":typeof n.key=="number"?console.log("unsupported root patch",n.key):typeof n.key=="string"&&n.key=="cells"&&this.diffCells(n.diff);break;default:console.log("unsupported change ",n.op)}}},n.prototype.addLeftCells=function(n,t){for(var e=this.diff.left,i,f,r=0,u=e.cells;r<u.length;r++)i=u[r],f=sourceLength(i),t&&(this.ensureMetadata(i).nbLineClasses=fillArray(f.line,t)),i.metadata.collapsed=n,this.impactedCells.push(i)},n.prototype.addRightCells=function(){for(var u=this.diff.right,n,r,t=0,i=u.cells;t<i.length;t++)n=i[t],r=sourceLength(n),this.ensureMetadata(n).nbLineClasses=fillArray(r.line,"diff-add"),n.metadata.collapsed=!1,this.impactedCells.push(n)},n.prototype.diffCells=function(n){function g(n){while(u<n){var t=y.diff.left.cells[u];y.ensureMetadata(t).collapsed=!0;t.metadata.nbLineClasses=[];y.impactedCells.push(t);u++}}for(var d=this.diff.left.cells,u=0,y=this,r,f,w,t,c,b,i,l,nt,tt,a,k,e,v,s,o,h=0,p=n;h<p.length;h++){r=p[h];f=r.key;g(f);switch(r.op){case"patch":for(u++,w=d[f],t=angular.copy(w),c=0,b=r.diff;c<b.length;c++){i=b[c];switch(i.key){case"source":switch(i.op){case"patch":l=this.buildSourceDiff(sourceToArray(w.source),i.diff);t.source=l.lines;this.ensureMetadata(t).nbDiffRanges=l.ranges;t.metadata.nbLineClasses=l.classes;break;default:console.log("unsupported source op "+i.op)}break;case"execution_count":switch(i.op){case"replace":nt=t.execution_count;t.execution_count=i.value;t.previous_execution_count=nt}break;case"cell_type":console.log("unsupported cell type change");break;case"metadata":switch(i.op){case"patch":this.diffMetadata(t.metadata,i.diff);break;default:console.log("unsupported metadata change");t.metadata.nbMetadataChanged=!0}break;case"outputs":switch(i.op){case"patch":t.outputs=this.buildOutputsDiff(t.outputs,i.diff)}}}this.ensureMetadata(t).collapsed=!1;this.impactedCells.push(t);break;case"addrange":for(tt=r.valuelist,a=0,k=tt;a<k.length;a++)e=k[a],o=sourceLength(e),this.ensureMetadata(e).nbLineClasses=fillArray(o.line,"diff-add"),e.metadata.collapsed=!1,this.impactedCells.push(e);break;case"removerange":for(u=f+1,v=0;v<r.length;v++)s=angular.copy(d[v+f]),o=sourceLength(s),this.ensureMetadata(s).nbLineClasses=fillArray(o.line,"diff-remove"),s.metadata.collapsed=!1,this.impactedCells.push(s)}}g(this.diff.left.cells.length)},n.prototype.diffMetadata=function(n,t){for(var i,o,l,r,u,s,a,h,v,f,e=0,c=t;e<c.length;e++){i=c[e];switch(i.op){case"patch":switch(i.key){case"tags":for(o=0,l=i.diff;o<l.length;o++){r=l[o];switch(r.op){case"removerange":for(n.nbTagsRemoved==undefined&&(n.nbTagsRemoved=[]),u=0;u<r.length;u++)n.nbTagsRemoved.push(n.tags[u+r.key]),delete n.tags[u+r.key];break;case"addrange":for(n.nbTagsAdded==undefined&&(n.nbTagsAdded=[]),s=0,a=r.valuelist;s<a.length;s++)f=a[s],n.nbTagsAdded.push(f);break;case"patch":n.nbMetadataChanged=!0}}n.tags=n.tags.filter(function(n){return n!==undefined});break;default:n.nbMetadataChanged=!0}break;case"add":switch(i.key){case"tags":for(n.nbTagsAdded=[],h=0,v=i.value;h<v.length;h++)f=v[h],n.nbTagsAdded.push(f);break;default:n.nbMetadataChanged=!0}break;case"remove":switch(i.key){case"tags":n.nbTagsRemoved=n.tags;n.tags=[];break;default:n.nbMetadataChanged=!0}break;default:n.nbMetadataChanged=!0}}},n.prototype.diffLine=function(n,t,i){for(var u=n,s=[],h=[],f=0,r,e=0,o=i;e<o.length;e++){r=o[e];switch(r.op){case"addrange":u=u.slice(0,r.key+f)+r.valuelist+u.slice(r.key+f);s.push({start:r.key+f,length:r.valuelist.length});f+=r.valuelist.length;break;case"removerange":u=u.slice(0,r.key+f)+u.slice(r.key+r.length+f);h.push({start:r.key,length:r.length});f-=r.length}}return{line:u,adds:s,removes:h}},n.prototype.buildSourceDiff=function(n,t){function tt(n,t){var i,o,e;for(t>0&&u[t-1].slice(-1)!="\n"&&(u[t-1]+="\n"),u.splice(t,0,n.line),f.splice(t,0,"diff-add"),i=0,o=n.adds;i<o.length;i++)e=o[i],p.push({kind:"diff-add",start:{line:t,ch:e.start},stop:{line:t,ch:e.start+e.length}});r+=1}function o(){for(var i,n=0,t=w;n<t.length;n++)i=t[n],tt(i,e+r+1);w=[]}for(var u=angular.copy(n),f=fillArray(n.length,undefined),p=[],r=0,e=-1,w=[],i,h,k,c,d,l,v,g,y,s=0,b=t;s<b.length;s++){i=b[s];switch(i.op){case"addrange":for(o(),h=0,k=i.valuelist;h<k.length;h++)c=k[h],d=i.key+r,c.slice(-1)!="\n"&&(c+="\n"),u.splice(d,0,c),f.splice(d,0,"diff-add"),r+=1;break;case"removerange":for(o(),l=0;l<i.length;l++)f[i.key+r+l]="diff-remove";break;case"patch":var it=n[i.key],a=i.key+r,nt=this.diffLine(it,a,i.diff);for(f[a]="diff-remove",v=0,g=nt.removes;v<g.length;v++)y=g[v],p.push({kind:"diff-remove",start:{line:a,ch:y.start},stop:{line:a,ch:y.start+y.length}});e!=-1&&e+1!=i.key?(e=i.key,o()):(e=i.key,w.push(nt));break;default:console.log("unsupported op "+i.op)}}return o(),{lines:u,classes:f,ranges:p}},n.prototype.patchOutput=function(n,t){for(var i,u,f,h,e,v,c,l,o,a,r=0,s=t;r<s.length;r++){i=s[r];switch(i.key){case"data":u=n.data;switch(i.op){case"patch":for(f=0,h=i.diff;f<h.length;f++){e=h[f];switch(e.key){case"text/plain":v=u["text/plain"];switch(e.op){case"patch":c=u["text/plain"];l=this.buildSourceDiff(sourceToArray(c),e.diff);u["application/nbdiff"]=l}break;case"image/png":console.log("image diff")}}break;case"addrange":case"removerange":console.log("unsupported output diff",i.op)}break;case"execution_count":switch(i.op){case"replace":o=n;a=o.execution_count;o.execution_count=i.value;o.previous_execution_count=a}}}},n.prototype.ensureMetadata=function(n){return n.metadata||(n.metadata={}),n.metadata},n.prototype.buildOutputsDiff=function(n,t){for(var u=angular.copy(n),f=0,i,r,e=0,o=t;e<o.length;e++){i=o[e];switch(i.op){case"patch":this.patchOutput(u[i.key],i.diff);break;case"addrange":for(r=0;r<i.valuelist.length;r++)u.splice(i.key+f,0,i.valuelist[r]),this.ensureMetadata(u[i.key+f]).nbChangeKind="add",f++;break;case"removerange":for(r=0;r<i.length;r++)this.ensureMetadata(u[i.key+f]).nbChangeKind="remove";break;default:console.log("unsupported output op",i.op)}}return u},n}();IpynbDiffController.$inject=[];angular.module("notebooks.diff").component("ipynbDiff",{templateUrl:"/content/app/diff/ipynbDiff.html",controller:IpynbDiffController,bindings:{diff:"<"}});TextDiffController=function(){function n(){this.offsets=[]}return n.prototype.$onChanges=function(){var f=this,i="text",u,t,r,n;switch(this.diff.extension.toLowerCase()){case"py":i="python";case"r":i="r";case"md":i="markdown"}this.codemirrorOptions={lineWrapping:!1,lineNumbers:!0,readOnly:!0,mode:i,onLoad:function(n){n.on("change",function(){var t,r,i;if(f.offsets)for(t=0,r=f.offsets;t<r.length;t++)i=r[t],n.markText(i.start,i.stop,{className:i.kind})})}};this.diff.left&&this.diff.right?(u=new diff_match_patch,t=u.diff_main(this.diff.left,this.diff.right),u.diff_cleanupSemantic(t),diff_cleanupNewlines(t),this.input=t.map(function(n){return n[1]}).join(""),r=0,n=0,this.offsets=t.map(function(t){var i=t[1],u="";switch(t[0]){case DIFF_INSERT:u="diff-add";break;case DIFF_DELETE:u="diff-remove";break;default:u=""}for(var o={line:r,ch:n},f=-1,e=!1;(f=i.indexOf("\n",f+1))!=-1;)r++,n=0,e=!0;return e?n=i.length-i.lastIndexOf("\n"):n+=i.length,i.length-i.lastIndexOf("\n"),{start:o,stop:{line:r,ch:n},kind:u,text:i}})):this.input=this.diff.left||this.diff.right},n}();TextDiffController.$inject=[];angular.module("notebooks.diff").component("textDiff",{templateUrl:"/content/app/diff/textDiff.html",controller:TextDiffController,bindings:{diff:"<"}});angular.module("notebooks.whatsnew",["ngRoute"]).config(["$routeProvider",function(n){n.when("/new",{templateUrl:"/content/app/whatsnew/whatsnew.html"})}]).directive("release",function(){return{restrict:"E",templateUrl:"/content/app/whatsnew/release.html",scope:{hotfix:"=",description:"="},transclude:!0,link:function(n,t,i){n.datetime=new Date(i.datetime)}}}).directive("fix",function(){return{restrict:"E",transclude:!0,templateUrl:"/content/app/whatsnew/fix.html"}}).directive("feature",function(){return{restrict:"E",transclude:!0,templateUrl:"/content/app/whatsnew/feature.html"}});ProfileController=function(){function n(n,t,i,r,u,f,e,o,s){var l=this,h,c;this.user=n;this.UserService=t;this.$scope=i;this.LibraryService=r;this.$uibModal=u;this.LogService=f;this.$location=e;this.signedIn=o;this.DialogService=s;this.contextHelpLink="/help/profiles/profile-page";h=this;t.checkSignedIn().then(function(){l.isOwner=t.user.id==n.id||n.id=="home";var i=e.search().signin;l.isOwner&&i&&(!t.user.id||t.user.generatedId?s.userIdInit(t.user,"Welcome to Azure Notebooks!  Please create a user name for your profile.").closed.then(function(){t.user.id?e.url("/"+t.user.id):e.url("/home");e.replace()}):(e.url("/"+t.user.id),e.replace()))});n.id?(c=this.UserService.getLibrariesCached(n.id),c&&h.setItems(c),this.UserService.getLibraries(n.id,{top:6,orderBy:"modifiedDate",includeDescription:!0}).then(function(n){h.setItems(n)})):h.setItems([])}return n.prototype.setItems=function(n){n.sort(function(n,t){var i=n.modified.toLowerCase(),r=t.modified.toLowerCase();return n==t?0:n>t?-1:1});this.libraries=n.slice(0,6)},n.prototype.download=function(n){this.LogService.metric("Command.Profile.DownloadLibrary",1,{library:n.id});this.LibraryService.downloadLibrary(n)},n.prototype.cloneAndRun=function(n){this.LogService.metric("Command.Profile.Clone",1,{library:n.id});this.LibraryService.cloneAndRun(n)},n.prototype.openSimple=function(n,t,i,r){return this.$uibModal.open({animation:!0,templateUrl:n,controller:t,controllerAs:i,resolve:r})},n.prototype.share=function(n){this.LogService.metric("Command.Profile.Share",1,{library:n.id});this.openSimple("/content/app/libraries/shareLibrary.html","ShareLibraryController","$ctrl",{library:n})},n.prototype.add=function(){var n=this;this.LogService.metric("Command.Profile.Add",1);this.openSimple("/content/app/libraries/new.html","NewLibraryController","newLibrary",{dashboard:this,baseLibraryUrl:function(){return n.$location.protocol()+"://"+n.$location.host()+"/"+n.user.id+"/libraries/"},userLibrary:function(){return!0},userId:function(){return n.UserService.user.id}})},n}();ProfileController.$inject=["user","UserService","$scope","LibraryService","$uibModal","LogService","$location","signedIn","DialogService"];angular.module("notebooks.user").controller("ProfileController",ProfileController);angular.module("ui.codemirror",[]).constant("uiCodemirrorConfig",{}).directive("uiCodemirror",["$timeout","uiCodemirrorConfig",uiCodemirrorDirective]),function(n){angular.module("ui.bootstrap.contextMenu",[]).service("CustomService",function(){return{initialize:function(n){console.log("got here",n)}}}).directive("contextMenu",["$parse","$q","CustomService","$sce",function(t,i,r){function a(t){var h=t.$scope,r=t.item,v=t.event,y=t.modelValue,p=t.$promises,w=t.nestedMenu,b=t.$li,a=String(t.orientation).toLowerCase()==="left",c=null,u,f,e,o,l;r.html?c=angular.isFunction(r.html)?r.html(h):r.html:(u=n("<a>"),f={},a?(f.textAlign="right",f.paddingLeft="8px"):(f.textAlign="left",f.paddingRight="8px"),u.css(f),u.attr({tabindex:"-1",href:"#"}),e=r[0],o=s,typeof e=="string"?o=e:typeof e=="function"?o=e.call(h,h,v,y):typeof r.text!="undefined"&&(o=r.text),l=i.when(o),p.push(l),l.then(function(t){var r,i,f;w&&(i={fontFamily:"monospace",fontWeight:"bold"},a?(r="&lt;",i.float="left"):(r="&gt;",i.float="right"),f=n('<strong style="font-family:monospace;font-weight:bold;float:right;">'+r+"<\/strong>"),f.css(i),u.css("cursor","default"),u.append(f));u.append(t)}),c=u);b.append(c)}function v(n){var i=p(n),r=s,t=angular.extend({},n);t.nestedMenu=i;t.enabled=k(t);t.text=a(t);y(t)}function y(t){var s=t.item,c=t.$ul,r=t.$li,e=t.$scope,a=t.modelValue,l=t.level,u=t.event,w=t.text,v=t.nestedMenu,b=t.enabled,y=String(t.orientation).toLowerCase(),p;if(b){p=function(n){o(l+1);var t={pageX:y==="left"?u.pageX-c[0].offsetWidth+1:u.pageX+c[0].offsetWidth-1,pageY:c[0].offsetTop+r[0].offsetTop-3,view:u.view||window,target:u.target,event:n};i.when(v).then(function(n){var i={$scope:e,event:t,options:n,modelValue:a,level:l+1,orientation:y};h(i)})};r.on("click",function(t){t.which==1&&(t.preventDefault(),e.$apply(function(){n(u.currentTarget).removeClass("context");f();var t=angular.isFunction(s.click)?s.click:angular.isFunction(s[1])?s[1]:null;t&&t.call(e,e,u,a,w,r)}))});r.on("mouseover",function(n){e.$apply(function(){v?p(n):o(l+1)})})}else{r.on("click",function(n){n.preventDefault()});r.addClass("disabled")}}function p(n){var t=n.item;return t.children?angular.isFunction(t.children)?t.children():angular.isFunction(t.children.then)||angular.isArray(t.children)?t.children:null:angular.isArray(t[1])||t[1]&&angular.isFunction(t[1].then)?t[1]:angular.isArray(t[2])||t[2]&&angular.isFunction(t[2].then)?t[2]:angular.isArray(t[3])||t[3]&&angular.isFunction(t[3].then)?t[3]:null}function h(t){var o=t.$scope,s=t.event,e=t.options,h=t.modelValue,c=t.level,l=t.customClass,i=b(t),f;t.$ul=i;u.push(i);f=[];t.$promises=f;angular.forEach(e,function(u){var f=n("<li>"),e;u===null?f.addClass("divider"):typeof u[0]=="object"?r.initialize(f,u):(e=angular.extend({},t),e.item=u,e.$li=f,v(e));i.append(f)});n(document).find("body").append(i);w(t)}function w(n){var r=n.$ul,f=n.$promises,u=n.level,t=n.event,e=String(n.orientation).toLowerCase()==="left";i.all(f).then(function(){var i=t.pageY,c=angular.element(r[0]).prop("offsetHeight"),l=window.scrollY+t.view.innerHeight,a,s;i>c&&l-i<c+20?(i=t.pageY-c,u&&u>0&&(i+=t.event.currentTarget.offsetHeight)):l<=c?(angular.element(r[0]).css({height:l-5,"overflow-y":"scroll"}),i=0):l-i<c&&(a=5,i<a&&(a=i),i=l-c-a);var n=t.pageX,f=angular.element(r[0]).prop("offsetWidth"),h=t.view.innerWidth,o=5;e?h-n>f&&n<f+o?n=o:n<f?(s=5,h-n<s+o&&(s=h-n+o),n=f+s+o):n=n-f:n>f&&h-n-o<f?n=h-f-o:h-n<f&&(s=5,n<s+o&&(s=n+o),n=h-f-s-o);r.css({display:"block",position:"absolute",left:n+"px",top:i+"px"})})}function b(t){var r=t.customClass,i=n("<ul>");return i.addClass("dropdown-menu"),i.attr({role:"menu"}),i.css({display:"block",position:"absolute",left:t.event.pageX+"px",top:t.event.pageY+"px","z-index":1e4}),r&&i.addClass(r),i}function k(n){var t=n.item,i=n.$scope,r=n.event,u=n.modelValue,f=n.text;return typeof t.enabled!="undefined"?t.enabled.call(i,i,r,u,f):typeof t[2]=="function"?t[2].call(i,i,r,u,f):!0}function d(){return"ontouchstart"in window||navigator.maxTouchPoints}function o(n){while(u.length&&(!n||u.length>n))u.pop().remove()}function c(n){f(n)}function l(t){for(var i=n(t.target),r=!0;i.length;)if(i.hasClass("dropdown-menu")){r=!1;break}else i=i.parent();r&&f(t)}function f(){n(document.body).off("mousedown",l);n(document).off("scroll",c);n(e).removeClass("context");o()}var u=[],e=null,s="New Item";return function(t,i,r){var u="contextmenu";r.contextMenuOn&&typeof r.contextMenuOn=="string"&&(u=r.contextMenuOn);i.on(u,function(u){if(r.allowEventPropagation||(u.stopPropagation(),u.preventDefault()),d()&&i.attr("draggable")==="true")return!1;n(document.body).on("mousedown",l);n(document).on("scroll",c);e=u.currentTarget;n(e).addClass("context");t.$apply(function(){var n=t.$eval(r.contextMenu),i=r.contextMenuClass,f=t.$eval(r.model),e=r.contextMenuOrientation,o={$scope:t,event:u,options:n,modelValue:f,level:0,customClass:i,orientation:e};if(n instanceof Array){if(n.length===0)return;h(o)}else throw'"'+r.contextMenu+'" not an array';});t.$on("$destroy",function(){f()})})}}])}(window.angular.element),function(n,t){function f(n){if(!("clientX"in n)&&!("clientY"in n)){var t=n.touches||n.originalEvent.touches;t&&t.length&&(n.clientX=t[0].clientX,n.clientY=t[0].clientY);n.preventDefault()}}function s(n){if(n=n[0],n.previousElementSibling)return t.element(n.previousElementSibling);for(var i=n.previousSibling;i!=null&&i.nodeType!=1;)i=i.previousSibling;return t.element(i)}function h(n,t){var i=s(n);i.length>0?i.after(t):n.parent().prepend(t)}function e(n,i){return n instanceof t.element&&(n=n[0]),u!==null?n[u](i):void 0}var r=t.module("angular-sortable-view",[]),i,u,o;if(r.directive("svRoot",[function(){function r(n,t,i){return i?n.x-t.x<0:n.y-t.y<0}function n(n){return t[n]}function u(n){delete t[n]}var i,t=Object.create(null);return{restrict:"A",controller:["$scope","$attrs","$interpolate","$parse",function(f,o,s,c){var y=s(o.svRoot)(f)||f.$id,k,d;t[y]||(t[y]=[]);var tt=this,p,l,g,v,b,a,w=!1,nt=c(o.svOnSort);if(o.svOnStart=o.$$element[0].attributes["sv-on-start"],o.svOnStart=o.svOnStart&&o.svOnStart.value,o.svOnStop=o.$$element[0].attributes["sv-on-stop"],o.svOnStop=o.svOnStop&&o.svOnStop.value,k=c(o.svOnStart),d=c(o.svOnStop),this.sortingInProgress=function(){return i},o.svGrid){if(w=o.svGrid==="true"?!0:o.svGrid==="false"?!1:null,w===null)throw"Invalid value of sv-grid attribute";}else f.$watchCollection(function(){return n(y)},function(n){w=!1;var i=n.filter(function(n){return!n.container}).map(function(n){return{part:n.getPart().id,y:n.element[0].getBoundingClientRect().top}}),t=Object.create(null);i.forEach(function(n){t[n.part]?t[n.part].push(n.y):t[n.part]=[n.y]});Object.keys(t).forEach(function(n){t[n].sort();t[n].forEach(function(i,r){r<t[n].length-1&&i>0&&i===t[n][r+1]&&(w=!0)})})});this.$moveUpdate=function(t,u,o,s,c,d,nt){var tt=o[0].getBoundingClientRect(),it,rt;t.tolerance==="element"&&(u={x:~~(tt.left+tt.width/2),y:~~(tt.top+tt.height/2)});i=!0;p=[];l||(c?(l=c.clone(),l.removeClass("ng-hide")):(l=s.clone(),l.addClass("sv-visibility-hidden"),l.addClass("sv-placeholder"),l.css({height:tt.height+"px",width:tt.width+"px"})),s.after(l),s.addClass("ng-hide"),b=s,g=t,v=o,k(f,{$helper:{element:v},$part:d.model(d.scope),$index:nt,$item:d.model(d.scope)[nt]}),f.$root&&f.$root.$$phase||f.$apply());v[0].reposition({x:u.x+document.body.scrollLeft-u.offset.x*tt.width,y:u.y+document.body.scrollTop-u.offset.y*tt.height});n(y).forEach(function(n){if(t.containment==null||e(n.element,t.containment)||e(n.element,t.containment+" *")){var f=n.element[0].getBoundingClientRect(),i={x:~~(f.left+f.width/2),y:~~(f.top+f.height/2)};!n.container&&(n.element[0].scrollHeight||n.element[0].scrollWidth)&&p.push({element:n.element,q:(i.x-u.x)*(i.x-u.x)+(i.y-u.y)*(i.y-u.y),view:n.getPart(),targetIndex:n.getIndex(),after:r(i,u,w)});n.container&&!n.element[0].querySelector("[sv-element]:not(.sv-placeholder):not(.sv-source)")&&p.push({element:n.element,q:(i.x-u.x)*(i.x-u.x)+(i.y-u.y)*(i.y-u.y),view:n.getPart(),targetIndex:0,container:!0})}});it=l[0].getBoundingClientRect();rt={x:~~(it.left+it.width/2),y:~~(it.top+it.height/2)};p.push({q:(rt.x-u.x)*(rt.x-u.x)+(rt.y-u.y)*(rt.y-u.y),element:l,placeholder:!0});p.sort(function(n,t){return n.q-t.q});p.forEach(function(n,t){t!==0||n.placeholder||n.container?t===0&&n.container?(a=n,n.element.append(l)):n.element.removeClass("sv-candidate"):(a=n,n.element.addClass("sv-candidate"),n.after?n.element.after(l):h(n.element,l))})};this.$drop=function(n,t,r){function s(){if(i=!1,l.remove(),v.remove(),b.removeClass("ng-hide"),p=void 0,l=void 0,r=void 0,v=void 0,b=void 0,d(f,{$part:n.model(n.scope),$index:t,$item:n.model(n.scope)[t]}),a){a.element.removeClass("sv-candidate");var e=n.model(n.scope).splice(t,1),u=a.targetIndex;a.view===n&&a.targetIndex>t&&u--;a.after&&u++;a.view.model(a.view.scope).splice(u,0,e[0]);(a.view!==n||t!==u)&&nt(f,{$partTo:a.view.model(a.view.scope),$partFrom:n.model(n.scope),$item:e[0],$indexTo:u,$indexFrom:t})}a=void 0;f.$root&&f.$root.$$phase||f.$apply()}if(l)if(r.revert){var u=l[0].getBoundingClientRect(),o=v[0].getBoundingClientRect(),h=Math.sqrt(Math.pow(o.top-u.top,2)+Math.pow(o.left-u.left,2)),e=+r.revert*h/200;e=Math.min(e,+r.revert);["-webkit-","-moz-","-ms-","-o-",""].forEach(function(n){typeof v[0].style[n+"transition"]!="undefined"&&(v[0].style[n+"transition"]="all "+e+"ms ease")});setTimeout(s,e);v.css({top:u.top+document.body.scrollTop+"px",left:u.left+document.body.scrollLeft+"px"})}else s()};this.addToSortableElements=function(t){n(y).push(t)};this.removeFromSortableElements=function(t){var i=n(y),r=i.indexOf(t);r>-1&&(i.splice(r,1),i.length===0&&u(y))}}]}}]),r.directive("svPart",["$parse",function(n){return{restrict:"A",require:"^svRoot",controller:["$scope",function(n){n.$ctrl=this;this.getPart=function(){return n.part};this.$drop=function(t,i){n.$sortableRoot.$drop(n.part,t,i)}}],scope:!0,link:function(t,i,r,u){var f,e;if(!r.svPart)throw new Error("no model provided");if(f=n(r.svPart),!f.assign)throw new Error("model not assignable");t.part={id:t.$id,element:i,model:f,scope:t};t.$sortableRoot=u;e={element:i,getPart:t.$ctrl.getPart,container:!0};u.addToSortableElements(e);t.$on("$destroy",function(){u.removeFromSortableElements(e)})}}}]),r.directive("svElement",["$parse",function(n){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function(n){n.$ctrl=this}],link:function(i,r,u,e){function v(h){function d(n){f(n);a||(r.parent().prepend(p),a=!0);e[1].$moveUpdate(w,{x:n.clientX,y:n.clientY,offset:k},p,r,l,e[0].getPart(),i.$index)}var w,v,b,y,p,k;if((f(h),!e[1].sortingInProgress())&&(h.button==0||h.type!=="mousedown")){a=!1;w=n(u.svElement)(i);w=t.extend({},{tolerance:"pointer",revert:200,containment:"html"},w);w.containment&&(v=o.call(r,w.containment)[0].getBoundingClientRect());b=r;y=r[0].getBoundingClientRect();c||(c=e[0].helper);l||(l=e[0].placeholder);c?(p=c.clone(),p.removeClass("ng-hide"),p.css({left:y.left+document.body.scrollLeft+"px",top:y.top+document.body.scrollTop+"px"}),b.addClass("sv-visibility-hidden")):(p=b.clone(),p.addClass("sv-helper").css({left:y.left+document.body.scrollLeft+"px",top:y.top+document.body.scrollTop+"px",width:y.width+"px"}));p[0].reposition=function(n){var i=n.x,r=n.y,u=p[0].getBoundingClientRect(),t=document.body;v&&(r<v.top+t.scrollTop&&(r=v.top+t.scrollTop),r+u.height>v.top+t.scrollTop+v.height&&(r=v.top+t.scrollTop+v.height-u.height),i<v.left+t.scrollLeft&&(i=v.left+t.scrollLeft),i+u.width>v.left+t.scrollLeft+v.width&&(i=v.left+t.scrollLeft+v.width-u.width));this.style.left=i-t.scrollLeft+"px";this.style.top=r-t.scrollTop+"px"};k={x:(h.clientX-y.left)/y.width,y:(h.clientY-y.top)/y.height};s.addClass("sv-sorting-in-progress");s.on("mousemove touchmove",d).on("mouseup touchend touchcancel",function g(){s.off("mousemove touchmove",d);s.off("mouseup touchend touchcancel",g);s.removeClass("sv-sorting-in-progress");a&&e[0].$drop(i.$index,w);r.removeClass("sv-visibility-hidden")})}}var y={element:r,getPart:e[0].getPart,getIndex:function(){return i.$index}},h,c,l,p,s,a;e[1].addToSortableElements(y);i.$on("$destroy",function(){e[1].removeFromSortableElements(y)});h=r;h.on("mousedown touchstart",v);i.$watch("$ctrl.handle",function(n){if(n){h.off("mousedown touchstart",v);h=n;h.on("mousedown touchstart",v)}});i.$watch("$ctrl.helper",function(n){n&&(c=n)});i.$watch("$ctrl.placeholder",function(n){n&&(l=n)});p=t.element(document.body);s=t.element(document.documentElement)}}}]),r.directive("svHandle",function(){return{require:"?^svElement",link:function(n,t,i,r){r&&(r.handle=t.add(r.handle))}}}),r.directive("svHelper",function(){return{require:["?^svPart","?^svElement"],link:function(n,t,i,r){t.addClass("sv-helper").addClass("ng-hide");r[1]?r[1].helper=t:r[0]&&(r[0].helper=t)}}}),r.directive("svPlaceholder",function(){return{require:["?^svPart","?^svElement"],link:function(n,t,i,r){t.addClass("sv-placeholder").addClass("ng-hide");r[1]?r[1].placeholder=t:r[0]&&(r[0].placeholder=t)}}}),t.element(document.head).append("<style>.sv-helper{position: fixed !important;z-index: 99999;margin: 0 !important;}.sv-candidate{}.sv-placeholder{}.sv-sorting-in-progress{-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}.sv-visibility-hidden{visibility: hidden !important;opacity: 0 !important;}<\/style>"),i=document.documentElement,u=i.matches?"matches":i.matchesSelector?"matchesSelector":i.webkitMatches?"webkitMatches":i.webkitMatchesSelector?"webkitMatchesSelector":i.msMatches?"msMatches":i.msMatchesSelector?"msMatchesSelector":i.mozMatches?"mozMatches":i.mozMatchesSelector?"mozMatchesSelector":null,u==null)throw"This browser doesn't support the HTMLElement.matches method";o=t.element.prototype.closest||function(n){for(var i=this[0].parentNode;i!==document.documentElement&&!i[u](n);)i=i.parentNode;return i[u](n)?t.element(i):t.element()};typeof t.element.prototype.add!="function"&&(t.element.prototype.add=function(n){var i,r=t.element();for(n=t.element(n),i=0;i<this.length;i++)r.push(this[i]);for(i=0;i<n.length;i++)r.push(n[i]);return r})}(window,window.angular)